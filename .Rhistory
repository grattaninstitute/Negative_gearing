svydesign(data = ., weights = ~Weight_HH_HES) %>%
svyquantile(design = ., quantiles = c(0:10)/10, ~Weekly_household_GST_on_all_goods_and_services_FIS)
library(survey)
hes10hh  %>%
group_by.income_quintile %>%
ungroup %>%
filter(income_quintile == 3) %>%
data.table %>%
svydesign(data = ., weights = ~Weight_HH_HES) %>%
svyquantile(design = ., quantiles = c(0:10)/10, ~Weekly_household_GST_on_all_goods_and_services_FIS)
hes10hh  %>%
group_by.income_quintile %>%
ungroup %>%
filter(income_quintile == 3) %>%
data.table %>%
svydesign(data = ., weights = ~Weight_HH_HES, ids = ~Unique_household_number) %>%
svyquantile(design = ., quantiles = c(0:10)/10, ~Weekly_household_GST_on_all_goods_and_services_FIS)
gst_by_income.2
gst_third.inc.quintile_deciles
gst_third.inc.quintile_deciles <-
hes10hh  %>%
group_by.income_quintile %>%
ungroup %>%
filter(income_quintile == 3) %>%
data.table %>%
svydesign(data = ., weights = ~Weight_HH_HES, ids = ~Unique_household_number) %>%
svyquantile(design = ., quantiles = c(0:10)/10, ~Weekly_household_GST_on_all_goods_and_services_FIS)
gst_third.inc.quintile_deciles
gst_third.inc.quintile_deciles[8]
get_sample_file(2013) %>%
group_by(income_quintile = ntile(Tot_inc_amt, 5)) %>%
summarise(mean.income = mean(Tot_inc_amt),
mean.tx.income = mean(Taxable_Income),
max. = max(Taxable_Income)) %>%
arrange(income_quintile)
gst_third.inc.quintile_deciles
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES)/1e6,
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
)
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES)/1e6,
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly/1e6,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.decile8 = gst_burden *
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES))) * 1e6 * 52.5) %>%
## Conversion to 2012-13:
mutate(gst_burden_after_transfer.annual.201213 = gst_burden_after_transfer.annual * GST_inflator_from0910_to1213)
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES)/1e6,
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly/1e6,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES))) * 1e6 * 52.5) %>%
## Conversion to 2012-13:
mutate(gst_burden_after_transfer.annual.201213 = gst_burden_after_transfer.annual * GST_inflator_from0910_to1213)
welfare.by.income.quintile_total
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES)/1e6,
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup
gst_revenue.15pc.weekly
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES)/1e6,
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly/1e6,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES))) * 1e6 * 52.5)
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES),
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES)))  * 52.5)
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES),
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES)))  * 52.5) %>%
## Conversion to 2012-13:
mutate(gst_burden_after_transfer.annual.201213 = gst_burden_after_transfer.annual * GST_inflator_from0910_to1213)
?svyby
get_gst_deciles <-
function(survey.design){
svyquantile(design = survey.design,
x = ~Weekly_household_GST_on_all_goods_and_services_FIS,
quantiles = c(0:10)/10)
}
hes10hh %>%
group_by.income_quintile %>%
ungroup %>%
svyby(~income_quintile, get_gst_deciles)
hes10hh %>%
group_by.income_quintile() %>%
ungroup %>%
svyby(~income_quintile, get_gst_deciles)
hes10hh %>%
group_by.income_quintile() %>%
ungroup %>%
svydesign(data = ., weights = ~Weight_HH_HES, ids = ~Unique_household_number) %>%
svyby(~income_quintile, get_gst_deciles(.))
hes10hh %>%
group_by.income_quintile() %>%
ungroup %>%
svydesign(data = ., weights = ~Weight_HH_HES, ids = ~Unique_household_number) %>%
svyby(~income_quintile, design = ., get_gst_deciles)
gst_by_income.2
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5* sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES),
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES)))  * 52.5) %>%
## Conversion to 2012-13:
mutate(gst_burden_after_transfer.annual.201213 = gst_burden_after_transfer.annual * GST_inflator_from0910_to1213)
gst_by_income.2 <-
hes10hh %>%
tbl_df %>%
group_by.income_quintile %>%
# 0.5 because 5pcpt increase
summarise(gst_burden = 0.5 * sum(Weekly_household_GST_on_all_goods_and_services_FIS*Weight_HH_HES),
gst_burden_weekly = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS, Weight_HH_HES),
income.tax = 52.5*weighted.mean(Household_weekly_expenditure_on_income_tax_HES_only, Weight_HH_HES),
taxable_income = new_inverse(pmax(0,income.tax)),
Weight_HH_HES = sum(Weight_HH_HES)
) %>%
arrange(income_quintile) %>%
mutate(prop_burden = gst_burden/sum(gst_burden)) %>%
merge(welfare.by.income.quintile_total, by = "income_quintile") %>%
ungroup %>%
mutate(comp_trsfr = prop_welfare * ratio.gst_welfare * gst_revenue.15pc.weekly,
gst_burden_after_transfer = gst_burden - comp_trsfr,
gst_burden_after_transfer.annual = (gst_burden_after_transfer / ((1/5)*sum(Weight_HH_HES)))  * 52.5) %>%
## Conversion to 2012-13:
mutate(gst_burden_after_transfer.annual.201213 = gst_burden_after_transfer.annual * GST_inflator_from0910_to1213)
gst_third.inc.quintile_deciles[8]/gst_by_income.2[gst_by_income.2$income_quintile == 3,]$gst_burden_weekly
ratio.gst.burden.80th.percentile.to.average_third.decile <-
gst_third.inc.quintile_deciles[8]/gst_by_income.2[gst_by_income.2$income_quintile == 3,]$gst_burden_weekly
gst_by_income.2 %<>%
mutate(gst_burden_after_transfer.annual.201213.decile8 = gst_burden_after_transfer.annual.201213 * ratio.gst.burden.80th.percentile.to.average_third.decile)
gst_by_income.2
93724
93724/2
93724/1.5
get_sample_file(2013)
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000)
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000) %>% grplot(aes(x = Tot_inc_amt, y = Taxable_Income)) + geom_point()
library(grattan)
library(ggplot2)
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000) %>% grplot(aes(x = Tot_inc_amt, y = Taxable_Income)) + geom_point()
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000) %>% ggplot(aes(x = Tot_inc_amt, y = Taxable_Income)) + geom_point()
rm(scale_dimension.custom_expand())
rm(scale_dimension.custom_expand
)
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000) %>% ggplot(aes(x = Tot_inc_amt, y = Taxable_Income)) + geom_point()
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 90000) %$% mean(Taxable_Income)
get_sample_file(2013) %>% select(Tot_inc_amt, Taxable_Income) %>% filter(round(Tot_inc_amt, -3) == 80000) %$% mean(Taxable_Income)
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013))
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% summary
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% summary %$% coef %>% extract(1)
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% summary %$% coef %>% extract2(1)
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% summary %>% extract(coef) %>% extract2(1)
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% summary %>% extract("coef") %>% extract2(1)
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% xoef
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% coef
lm(Taxable_Income ~ Tot_inc_amt, data = get_sample_file(2013)) %>% coef %>% extract2(2)
gst_by_income.2
hes10hh %>%
group_by.income_quintile() %>%
summarise(mean. = weighted.mean(Total_current_weekly_HH_income_from_all_sources_basis, Weight_HH_HES)*52.5,
max. = max(Total_current_weekly_HH_income_from_all_sources)*52.5) %>%
ungroup %>%
arrange(income_quintile) %>%
mutate(max.1213 = wage_inflator(max., from_fy = "2009-10", to_fy = "2012-13"))
gst_by_income.2 %<>%
mutate(gst_burden_after_transfer.annual.201213.decile8 = gst_burden_after_transfer.annual.201213 * ratio.gst.burden.80th.percentile.to.average_third.decile)
gst_by_income.2
93724*2/3
93724/3
1159+295
1180+236
hes10hh %$% sum(Weight_HH_HES * Weekly_household_GST_on_all_goods_and_services_FIS)
hes10hh %$% sum(Weight_HH_HES * Weekly_household_GST_on_all_goods_and_services_FIS) * 52.5/1e9
GST_inflator_from0910_to1213
hes10hh %$% sum(Weight_HH_HES * Weekly_household_GST_on_all_goods_and_services_FIS) * 52.5/1e9 * GST_inflator_from0910_to1213
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item))
library(readxl)
0.3*30
0.3*15
12/15
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item)) %>%
filter(grepl("^((2009)|(2013))", year))
library(tidyr)
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item)) %>%
filter(grepl("^((2009)|(2013))", year))
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item)) %>%
filter(grepl("^((2009)|(2012)|(2013))", year))
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item))
gst_by_income.2
gst_by_income.2
gst_by_income.2 %>%
select(income_quintile,
comp_trsfr,
gst_burden_after_transfer.annual,
gst_burden_after_transfer.annual.201213)
GST_by_year.actual <-
GST_inflator_from0910_to1314 <-
read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
setnames(1:2, c("Selected_item", "unit")) %>%
# en dash caution
setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
gather(year, value, `2001-02`:`2013-14`) %>%
mutate(value = as.numeric(value)) %>%
filter(complete.cases(.)) %>%
filter(grepl("Net.GST", Selected_item)) %>%
filter(grepl("^((2009)|(2012)|(2013))", year))
GST_by_year.actual
hes10hh %$%
sum(Weekly_household_GST_on_all_goods_and_services_FIS * Weight_HH_HES)
sum(Weekly_household_GST_on_all_goods_and_services_FIS * Weight_HH_HES) * 52.5/1e9
hes10hh %$%
sum(Weekly_household_GST_on_all_goods_and_services_FIS * Weight_HH_HES) * 52.5/1e6
gst_by_income.2
gst_201213
gst_by_income.2
GST_inflator_from0910_to1213 * 42146
ratio.gst.burden.80th.percentile.to.average_third.decile
93724*0.66
93724*0.66/2
93724*0.6666/2
93724*2/3
93722/3
perfect_and_imperfect.comp_adequacy.15pc <-
bind_rows(perfect_20pc_comp_adequacy.15pc, ordinary_20pc_comp_adequacy.15pc, .id = "targeting") %>%
mutate(targeting = ifelse(targeting == 1, "Perfect", "BAU")) %>%
mutate(targeting.text = ifelse(comp_adequacy == 1, targeting, NA_character_))
perfect_and_imperfect.comp_adequacy.15pc %>%
grplot(aes(x = comp_adequacy, y = percentage_compensated, group = targeting, color = targeting)) +
geom_line() +
geom_text(aes(label = targeting.text), vjust = 1.5, hjust = 1,
fontface = "bold", size =7) +
scale_x_continuous("Compensation threshold/Increased GST burden", label = scales::percent) +
scale_y_continuous("Percentage of bottom quintile meeting threshold", label = scales::percent) +
theme(axis.title.y = element_text(angle = 90))
temp.chessboard <-
data.table::CJ(
comp_adequacy = (0:200)/100,
Unique_household_number = hes10hh$Unique_household_number
)
percentage_revenue_ <- 0.30
perfect_20pc_comp_adequacy.15pc <-
hes10hh %>%
select(Weekly_household_GST_on_all_goods_and_services_FIS,
Total_current_weekly_HH_income_from_all_sources,
Weight_HH_HES
,Unique_household_number
) %>%
merge(., temp.chessboard, by = "Unique_household_number", all.y = TRUE) %>%
group_by.income_quintile %>%
ungroup %>%
data.table %>%
mutate(revenue_for_transfer = percentage_revenue_ * extra_gst.weekly) %>%
group_by(comp_adequacy) %>%
mutate(revenue_transfered = ifelse(income_quintile == 1,  # may be redundant but not sure
# We multiply by 5 because all the money is transferred to the bottom
# quintile.  I can't at this time convince myself why this
# multiple is necessary -- except the numbers don't look right
# without it.  In particular, even if all money is transferred to the
# bottom quintile, a large minority of households are undercompensated.
(five <- 5) * revenue_for_transfer/sum(Weight_HH_HES),
0)) %>%
data.table %>%
filter(income_quintile == 1) %>%
group_by(comp_adequacy) %>%
summarise(
percentage_compensated = weighted.mean(comp_adequacy * Weekly_household_GST_on_all_goods_and_services_FIS/2 < revenue_transfered,
w = Weight_HH_HES))
ordinary_20pc_comp_adequacy.15pc <-
hes10hh %>%
select(Weekly_household_GST_on_all_goods_and_services_FIS,
Total_current_weekly_HH_income_from_all_sources,
Weight_HH_HES
,Unique_household_number
) %>%
merge(., temp.chessboard, by = "Unique_household_number", all.y = TRUE) %>%
group_by.income_quintile %>%
ungroup %>%
data.table %>%
# Note trailing underscore for percentage_revenue_
mutate(revenue_for_transfer = percentage_revenue_ * extra_gst.weekly) %>%
group_by(comp_adequacy) %>%
mutate(revenue_transfered = ifelse(income_quintile == 1,  # may be redundant but not sure
# We multiply by 5 because all the money is transferred to the bottom
# quintile.  I can't at this time convince myself why this
# multiple is necessary -- except the numbers don't look right
# without it.  In particular, even if all money is transferred to the
# bottom quintile, a large minority of households are undercompensated.
(five <- 5) * revenue_for_transfer/sum(Weight_HH_HES),
0)) %>%
# Recalling that only a fraction of welfare actually goes to the bottom quintile:
mutate(revenue_transfered = proportion_of_welfare_bottom_quintile * revenue_transfered) %>%
data.table %>%
filter(income_quintile == 1) %>%
group_by(comp_adequacy) %>%
summarise(
percentage_compensated = weighted.mean(comp_adequacy * Weekly_household_GST_on_all_goods_and_services_FIS/2 < revenue_transfered,
w = Weight_HH_HES))
perfect_and_imperfect.comp_adequacy.15pc <-
bind_rows(perfect_20pc_comp_adequacy.15pc, ordinary_20pc_comp_adequacy.15pc, .id = "targeting") %>%
mutate(targeting = ifelse(targeting == 1, "Perfect", "BAU")) %>%
mutate(targeting.text = ifelse(comp_adequacy == 1, targeting, NA_character_))
perfect_and_imperfect.comp_adequacy.15pc %>%
grplot(aes(x = comp_adequacy, y = percentage_compensated, group = targeting, color = targeting)) +
geom_line() +
geom_text(aes(label = targeting.text), vjust = 1.5, hjust = 1,
fontface = "bold", size =7) +
scale_x_continuous("Compensation threshold/Increased GST burden", label = scales::percent) +
scale_y_continuous("Percentage of bottom quintile meeting threshold", label = scales::percent) +
theme(axis.title.y = element_text(angle = 90))
perfect_and_imperfect.comp_adequacy.15pc <-
bind_rows(perfect_20pc_comp_adequacy.15pc, ordinary_20pc_comp_adequacy.15pc, .id = "targeting") %>%
mutate(targeting = ifelse(targeting == 1, "Perfect", "BAU")) %>%
mutate(targeting.text = ifelse(comp_adequacy == 1, targeting, NA_character_))
perfect_and_imperfect.comp_adequacy.15pc %>%
grplot(aes(x = comp_adequacy, y = percentage_compensated, group = targeting, color = targeting)) +
geom_line() +
geom_text(aes(label = targeting.text), vjust = 1.5, hjust = 1,
fontface = "bold", size =7) +
scale_x_continuous("Compensation threshold/Increased GST burden", label = scales::percent) +
scale_y_continuous("Percentage of bottom quintile meeting threshold", limits = c(0,1), label = scales::percent) +
theme(axis.title.y = element_text(angle = 90))
proportion_of_welfare_bottom_quintile
grep("tax", names(.), value=T)
grep("tax", names(hes10hh), value=T)
hes10hh %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = income_tax_one_p)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = income_tax_one_p)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point()
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = income_tax_one_p)) + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only)) + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES)) + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10_indiv
grep("income", names(hes10_indiv), value=T)
grep("tax", names(hes10_indiv), value=T)
hes10hh %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5))
hes10hh %>% group_by.income_quintile() %>% ungroup %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, color = income_quintile, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5)) + coord_cartesian(xlim = c(0,100e3), ylim = c(0,100e3))
hes10hh %>% group_by.income_quintile() %>% ungroup %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(x = income_tax_one_p, color = income_quintile, y = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5)) + coord_cartesian(xlim = c(0,100e3), ylim = c(0,100e3)) +facet_grid(income_quintile ~ .)
hes10hh %>% group_by.income_quintile() %>% ungroup %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(y = income_tax_one_p, color = income_quintile, x = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5)) + coord_cartesian(xlim = c(0,100e3), ylim = c(0,100e3)) +facet_grid(income_quintile ~ .)
hes.sih.vars
hes10hh %>% select(Number_of_earners_in_the_household)
hes10hh %>% group_by.income_quintile() %>% ungroup %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(y = income_tax_one_p, color = Number_of_earners_in_the_household, x = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5)) + coord_cartesian(xlim = c(0,100e3), ylim = c(0,100e3)) +facet_grid(income_quintile ~ .)
hes10hh %>% group_by.income_quintile() %>% ungroup %>% mutate(income_tax_one_p = income_tax(Total_current_weekly_HH_income_from_all_sources*52.5, fy.year = "2009-10")) %>% grplot(aes(y = income_tax_one_p, color = Number_of_earners_in_the_household, x = 52.5* Household_weekly_expenditure_on_income_tax_HES_only, alpha = Weight_HH_HES/max(Weight_HH_HES))) + scale_alpha_identity() + geom_point() + scale_y_continuous(label=grattan_dollar, limits = c(0,4e5)) + scale_x_continuous(label=grattan_dollar, limits = c(0,4e5)) + coord_cartesian(xlim = c(0,100e3), ylim = c(0,100e3)) +facet_grid(Number_of_earners_in_the_household ~ .)
1086+93
735+63
798*1.3
798*42/28
798*42/28.5
hilda_list <-
lapply(list.files(path = "./HILDA",
pattern = ".dta$",
full.names = TRUE),
read.dta)
library(foreign)
library(ggplot2)
library(scales)
library(grattan)
library(dplyr)
read_hilda_file <-
function(filename){
data.table::data.table(foreign::read.dta(filename))
}
hilda_list <-
lapply(list.files(path = "./HILDA",
pattern = ".dta$",
full.names = TRUE),
read_hilda_file)
hilda_list <-
lapply(list.files(path = "./HILDA"
,pattern = "^E.*dta$"  # Enumerate person
,full.names = TRUE),
read_hilda_file)
gc(1,1)
gc(1,1)
rm(list = ls())
gc(1,1)
gc(1,1)
gc(1,1)

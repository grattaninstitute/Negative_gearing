mutate_("temp.col" = interp(paste0("rep(", .quintile.column, "each=2)")))
}
vignette("nse")
expand_quintile_to_decile(chessboard.childcare, "child_care.exp.est")
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
right_join(data.table(Quintile = (1:10)/2, age_group = .$age_group)) %>%
mutate_("temp.col" = lazyeval::interp(paste0("rep(", .quintile.column, "each=2)")))
}
expand_quintile_to_decile(chessboard.childcare, "child_care.exp.est")
vignette("lazyeval")
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
right_join(data.table(Quintile = (1:10)/2, age_group = .$age_group)) %>%
mutate_("temp.col" = quote(paste0("rep(", .quintile.column, "each=2)")))
}
expand_quintile_to_decile(chessboard.childcare, "child_care.exp.est")
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
right_join(data.table(Quintile = (1:10)/2, age_group = .$age_group)) %>%
mutate_("temp.col" = quote("rep(.quintile.column, each=2)"))
}
expand_quintile_to_decile(chessboard.childcare, "child_care.exp.est")
expand_quintile_to_decile(chessboard.childcare, .quintile.column = "child_care.exp.est")
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
right_join(data.table(Quintile = (1:10)/2, age_group = .$age_group)) %>%
mutate(temp.col = rep(~.quintile.column, each=2))
}
expand_quintile_to_decile(chessboard.childcare, .quintile.column = "child_care.exp.est")
expand_quintile_to_decile(chessboard.childcare, .quintile.column = child_care.exp.est)
names(chessboard.childcare)
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
right_join(data.table(Quintile = (1:10)/2, age_group = .$age_group)) %>%
mutate_(temp.col = rep(~.quintile.column, each=2))
}
names(chessboard.childcare)
expand_quintile_to_decile(chessboard.childcare, .quintile.column = child_care.exp.est)
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
bind_rows(.data) %>%
arrange(Quintile) %>%
mutate(decile = 1:10) %>%
mutate_(NewValue = quote(.quintile.column * 2))
}
expand_quintile_to_decile(chessboard.childcare, .quintile.column = child_care.exp.est)
expand_quintile_to_decile(chessboard.childcare, .quintile.column = "child_care.exp.est")
expand_quintile_to_decile <- function(.data, # a data containing a column Quintile and another column c
.quintile.column
){
.data %>%
bind_rows(.data) %>%
arrange(Quintile) %>%
mutate(decile = ifelse(Quintile == lag(Quintile),
Quintile * 2 - 1,
Quintile * 2)) %>%
mutate_(NewValue = quote(.quintile.column * 2))
}
expand_quintile_to_decile(chessboard.childcare, .quintile.column = "child_care.exp.est")
childcare_by_age
childcare_by_age %>% mutate_(.dots = setNames("x", list(lazyeval::interp(~child_care.expAge + 2)))
)
chessboard.childcare
data.table(Quintile = rep(1:5, each = 2))
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
)
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
)
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
) %>%
grplot(aes(x = age_group, y = Decile, alpha = child_care.exp.est.est))
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
) %>%
grplot(aes(x = age_group, y = Decile, alpha = child_care.exp.est.est)) +
geom_tile()
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
) %>%
grplot(aes(x = age_group, y = Decile, alpha = child_care.exp.est_decile)) +
geom_tile()
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
) %>%
grplot(aes(x = age_group, y = factor(Decile), alpha = child_care.exp.est_decile)) +
geom_tile()
food_by_age_and_income
health_by_age_and_income %>%
select(Total_income_decile, age_group, health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
mutate(Group = "Health")
health_by_age.income %>%
select(Total_income_decile, age_group, health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
mutate(Group = "Health")
health_by_age.income
health_by_age.income %>%
select(Total_income_decile, age_group, Health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
mutate(Group = "Health")
education_by_age_income
education_by_age_income <-
data.table::CJ(
Quintile = c(1:5, (1:5-0.5)),
age_group = education_by_age$age_group
) %>%
merge(., education_by_age, by = "age_group") %>%
setkey(Quintile) %>%
merge(., education_by_incomeQ) %>%
mutate(est.education.spend = education.exp.age * education.exp.prop.Q)
education_by_age_income
education_by_age_income
data.table::CJ(
Quintile = c(1:5, (1:5-0.5)),
age_group = education_by_age$age_group
) %>%
merge(., education_by_age, by = "age_group") %>%
setkey(Quintile) %>%
merge(., education_by_incomeQ) %>%
mutate(est.education.spend = education.exp.age * education.exp.prop.Q) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
education.exp.est_decile = est.education.spend / 2
)
food_by_age_income %>%
select(Total_income_decile, age_group, Food_exp.avg) %>%
setnames("Food_exp.avg", "est.expenditure") %>%
mutate(Group = "Food")
health_by_age_income %>%
select(Total_income_decile, age_group, Health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
mutate(Group = "Health")
education_by_age_income %>%
select(Decile, age_group, est.education.spend) %>%
# Note that this is not strictly true: it's household income.
setnames(c("Decile", "est.education.spend"),
c("Total_income_decile", "est.expenditure")) %>%
mutate(Group = "Education")
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
mutate(Group = "Childcare")
education_by_age_income
education_by_age_income <-
data.table::CJ(
Quintile = c(1:5, (1:5-0.5)),
age_group = education_by_age$age_group
) %>%
merge(., education_by_age, by = "age_group") %>%
setkey(Quintile) %>%
merge(., education_by_incomeQ) %>%
mutate(est.education.spend = education.exp.age * education.exp.prop.Q) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
education.exp.est_decile = est.education.spend / 2
)
education_by_age_income
bind_rows(food_by_age_income,
health_by_age_income,
education_by_age_income,
childcare_by_age_income)
food_by_age_income %<>%
select(Total_income_decile, age_group, Food_exp.avg) %>%
setnames("Food_exp.avg", "est.expenditure") %>%
mutate(Group = "Food")
source('~/.active-rstudio-document', echo=TRUE)
bind_rows(food_by_age_income,
health_by_age_income,
education_by_age_income,
childcare_by_age_income) %>%
group_by(Total_income_decile, age_group) %>%
summarise(total.expenditure = sum(est.expenditure))
unique(health_by_age_income$age_group)
unique(food_by_age_income$age_group)
unique(education_by_age_income$age_group)
unique(childcare_by_age_income$age_group)
age_group_tbl <-
fread("age_table.csv")
age_group_tbl
health_by_age_income %<>%
select(Total_income_decile, age_group, Health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
merge(., age_group_tbl, by.x = "age_group", by.x = "big_age")
childcare_by_age <-
read_excel("EducationChildcare_HES10_detailed.xlsx", sheet = "Childcare_by_age") %>%
gather(age_group, child_care.expAge, -Group) %>%
data.table
childcare_by_income <-
read_excel("EducationChildcare_HES10_detailed.xlsx", sheet = "Childcare_by_income") %>%
gather(Quintile, child_care.expQ, -Group) %>%
mutate(Quintile = as.integer(factor(Quintile))) %>%
filter(complete.cases(.)) %>%
mutate(child_care.expQ.prop = child_care.expQ/sum(child_care.expQ)) %>%
data.table
childcare_by_age_income <-
data.table::CJ(
Quintile = 1:5,
age_group = childcare_by_age$age_group
) %>%
setkey(Quintile) %>%
merge(., childcare_by_income) %>%
setkey(age_group) %>%
merge(., childcare_by_age) %>%
mutate(child_care.exp.est = child_care.expAge * child_care.expQ.prop) %>%
select(age_group, Quintile, child_care.exp.est) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
child_care.exp.est_decile = child_care.exp.est / 2
)
education_by_incomeQ <-
read_excel("Education_HES10_detailed.xlsx", sheet = "Education_by_income") %>%
filter(as.logical(Total)) %>% select(-Total, -Subgroup) %>%
gather(Quintile, amount, Q1:Q5) %>%
mutate(amount = as.numeric(gsub("*", "", amount, fixed = TRUE))) %>%
mutate(Quintile = as.integer(gsub("Q", "", Quintile))) %>%
group_by(Quintile) %>%
summarise(education.exp.Q = sum(amount)) %>%
ungroup %>%
mutate(education.exp.prop.Q = education.exp.Q / sum(education.exp.Q)) %>%
data.table %>%
setkey(Quintile)
education_by_age.names <-
read_excel("Education_HES10_detailed.xlsx", sheet = "Education_by_age") %>%
names
education_by_age <-
read_excel("Education_HES10_detailed.xlsx", sheet = "Education_by_age") %>%
gather_("age_group", "amount", grep("^[1-9]", education_by_age.names, value = TRUE)) %>%
filter(as.logical(Total)) %>% select(-Total, -Subgroup) %>%
mutate(amount = as.numeric(gsub("*", "", amount, fixed = TRUE))) %>%
group_by(age_group) %>%
summarise(education.exp.age = sum(amount)) %>%
ungroup %>%
mutate(education.exp.prop.age = education.exp.age / sum(education.exp.age)) %>%
data.table %>%
setkey(age_group)
# Assume that every age has the same distribution of education expenses by income
education_by_age_income <-
data.table::CJ(
Quintile = c(1:5, (1:5-0.5)),
age_group = education_by_age$age_group
) %>%
merge(., education_by_age, by = "age_group") %>%
setkey(Quintile) %>%
merge(., education_by_incomeQ) %>%
mutate(est.education.spend = education.exp.age * education.exp.prop.Q) %>%
right_join(.,
data.table(Quintile = rep(1:5, each = 2),
Decile = 1:10)
) %>%
mutate(
education.exp.est_decile = est.education.spend / 2
)
health_by_age_income %>%
select(Total_income_decile, age_group, Health_exp.avg) %>%
setnames("Health_exp.avg", "est.expenditure") %>%
merge(., age_group_tbl, by.x = "age_group", by.x = "big_age")
mutate(Group = "Health")
health_by_age_income
education_by_age_income %>%
select(Decile, age_group, est.education.spend) %>%
# Note that this is not strictly true: it's household income.
setnames(c("Decile", "est.education.spend"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.x = "big_age")
education_by_age_income
education_by_age_income %>%
select(Decile, age_group, est.education.spend)
education_by_age_income %>%
select(Decile, age_group, est.education.spend) %>%
# Note that this is not strictly true: it's household income.
setnames(c("Decile", "est.education.spend"),
c("Total_income_decile", "est.expenditure"))
education_by_age_income %>%
select(Decile, age_group, est.education.spend) %>%
# Note that this is not strictly true: it's household income.
setnames(c("Decile", "est.education.spend"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.x = "big_age")
education_by_age_income %>%
select(Decile, age_group, est.education.spend) %>%
# Note that this is not strictly true: it's household income.
setnames(c("Decile", "est.education.spend"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age")
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age") %>%
group_by(big_age) %>%
mutate(n = n())
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "little_age") %>%
group_by(big_age) %>%
mutate(n = n())
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "little_age") %>%
group_by(little_age) %>%
mutate(n = n())
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age") %>%
group_by(little_age) %>%
mutate(n = n())
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age") %>%
group_by(Total_income_decile, little_age) %>%
mutate(n = n())
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age") %>%
group_by(Total_income_decile, little_age) %>%
# assign equally among each subage
mutate(n = n()) %>%
mutate(est.expenditure = est.expenditure / n)
length(age_group_tbl$little_age)
childcare_by_age_income %>%
select(Decile, age_group, child_care.exp.est_decile) %>%
setnames(c("Decile", "child_care.exp.est_decile"),
c("Total_income_decile", "est.expenditure")) %>%
merge(., age_group_tbl, by.x = "age_group", by.y = "big_age") %>%
group_by(Total_income_decile, little_age) %>%
# assign equally among each subage
mutate(n = n()) %>%
mutate(est.expenditure = est.expenditure / n) %>% grplot(aes(x = little_age, y = Total_income_decile, alpha = est.expenditure)) + geom_tile()
source('~/.active-rstudio-document', echo=TRUE)
education_by_age_income
childcare_by_income
childcare_by_age_income
food_by_age_income
health_by_age_income
education_by_age_income
childcare_by_age_income
bind_rows(food_by_age_income,
health_by_age_income,
education_by_age_income,
childcare_by_age_income)
source('~/.active-rstudio-document', echo=TRUE)
GST_by_age_and_income %>%
grplot(aes(x = age_group,
y = Total_income_decile,
alpha = total.expenditure)) +
geom_tile(fill = Orange)
GST_by_age_and_income <-
bind_rows(food_by_age_income,
health_by_age_income,
education_by_age_income,
childcare_by_age_income) %>%
group_by(Total_income_decile, age_group) %>%
summarise(total.expenditure = sum(est.expenditure))
GST_by_age_and_income %>%
grplot(aes(x = age_group,
y = Total_income_decile,
alpha = total.expenditure)) +
geom_tile(fill = Orange)
GST_by_age_and_income %>% filter(age_group == "75 to 79")
GST_by_age_and_income %>% filter(age_group == "80 and over")
GST_by_age_and_income <-
bind_rows(food_by_age_income,
health_by_age_income,
education_by_age_income,
childcare_by_age_income) %>%
group_by(Total_income_decile, age_group) %>%
summarise(total.expenditure = sum(est.expenditure))
GST_by_age_and_income %>% filter(age_group == "75 to 79")
GST_by_age_and_income %>% filter(age_group == "75 to 79")
GST_by_age_and_income %>% str
GST_by_age_and_income %>%
grplot(aes(x = factor(age_group),
y = Total_income_decile,
alpha = total.expenditure)) +
geom_tile(fill = Orange)
GST_by_age_and_income %>%
grplot(aes(x = factor(age_group),
y = factor(Total_income_decile),
alpha = total.expenditure)) +
geom_tile(fill = Orange)
GST_by_age_and_income$age_group %>% str
GST_by_age_and_income$age_group %>% uniquie
GST_by_age_and_income$age_group %>% unique
GST_by_age_and_income %>%
mutate(age_group_text = gsub("\\s+", "\n", age_group)) %>%
grplot(aes(x = factor(age_group_text),
y = factor(Total_income_decile),
alpha = total.expenditure)) +
geom_tile(fill = Orange) +
scale_alpha_continuous(label=grattan_dollar) +
xlab("Age") +
coord_equal() +
theme_grattan(base_size = 18) +
theme(panel.grid.major.y = element_blank(),
legend.position = "right")


\chapter{Impact of changing negative gearing and the CGT discount}
Much of the political debate surrounding changes to negative gearing and the CGT discount have centred around the impact on investor demand, rents and property prices. 

Limiting loss write offs and increasing the effective tax rate on capital gains will reduce the after-tax returns on property investment. This will somewhat reduce investment demand. 

Economic theory suggests that the impact will be some combination of higher rents and lower house prices. But in urban housing markets with tight constraints on supply and where locational factors strongly influence rental demand, almost all of the impact will be on prices.  

But the price impacts will not be large. Our proposed reduction in tax concessions will result in modest changes in effective tax rates for investors. And owner occupiers -- the majority of property buyers -- face no change in their after tax returns. Our best estimate is that property taxes changes might reduce house prices by up to a one-off \TBD{xx -xx\%}, depending on how much the capital gains tax discount is reduced. There will be very little impact on rents, even after a decade.

\section{Tax changes will somewhat reduce investor demand}
Reducing the capital gains tax discount and limiting scope for loss write offs by changing negative gearing arrangements will somewhat increase the effective tax rates for property investors. 

Some investors will switch to other investment opportunities that offer higher post-tax returns. Others might choose to spend more and invest less. But some will also continue to invest in the housing market, and either borrow less, or simply accept a lower return on investment.

But the extent to which investors will vacate the property market will ultimately depend on how much post-tax returns fall, and how sensitive is investor demand for property to changes in returns (what economists would call the “elasticity of demand”).

Our analysis shows that the effective tax increases from our proposed changes to negative gearing and capital gains tax are relatively modest (Chapter 5). 
As a result, the changes in after tax returns are unlikely to have much effect on demand for investment property. Other investments that generate capital gains, such as shares, will also be subject to a more stringent tax treatment under most proposed changes to tax arrangements (Chapter 5). Other investments that will be relatively more attractive after the change -- for example, superannuation and bank deposits -- have a very different profile of risk, return and liquidity, which is likely to limit the extent of switching. 

Ultimately there are a whole host of factors that people take into account when investing in property, including rental returns (particularly for the one third of positively geared investors), risk perception, familiarity with the asset class and ability to obtain bank finance.  Modest changes in tax treatment will not change the decision-making calculus for the majority of investors. 

Indeed, looking at other countries with less generous tax treatment for investment properties -- US, Canada, Germany and France, for example -- there is still plenty of investor activity in housing.

\section{House price impacts will be modest}
The related concern is that house prices will fall as a result of the changes. 

Economic theory suggests the impact of reduced after tax returns to investors will be a combination of higher rents and lower house prices.  But both theory and empirical research has shown that in urban areas where land supply is restricted and rents are determined by location specific factors such as access to transportation and amenities, then tax changes tend to affect prices rather than rents.  

But the overall decrease in house prices is not likely to be large. Around two thirds of buyers -- owner occupiers -- will be not be affected by the tax changes. Even assuming that the change in tax benefits are fully passed through to prices, the price impact will be less than xx (Box 6). Indeed, house prices may not actually fall if market dynamics continue to push prices upwards. But prices will be lower than they would have been in the absence of the tax changes.

\begin{smallbox}{Impact of negative gearing \TBD{and CGT} on house prices}{box:ImpactOfPrice}

Limiting negative gearing and reducing the CGT discount will reduce the post-tax investment returns for property investors. There will be a one-off decrease in house prices as investors reduce their willingness to pay. 

The impact on prices depends on investor expectations of the size of the lost tax benefit. Average annual rental losses over the last decade were \$12~billion, generating annual tax write-offs on average of \$4.7~billion. If investor expectations are guided by history, then the expected present value of future tax benefits from negative gearing would be around \$110~billion.

If the lost tax benefit were fully capitalised in the value of residential property -- currently worth \$5400~billion -- prices would fall, but only in the order of 2~per cent. For policies that limit negative gearing the price impacts would be smaller since some of the tax benefits are retained. If investment losses are quarantined so they can’t be written off against wage and salary income, the present value of tax benefits lost might be \$50~billion, with a maximum impact on property prices of 0.9~per cent. 

But if there is a more segmented investor housing market, price effects could be larger. To take an extreme example, if \$280~billion of housing owned by investors was an entirely separate market, quarantining negative gearing might reduce prices in this market by as much as 18~per cent. In reality, some owner occupiers will be competing for these same houses and so price reductions are likely to be limited to single digits. 
\end{smallbox}

Any impact on prices could well be swamped by the effects of broader changes in the economy. As the CBA Chief Executive Ian Narev recently noted:

\begin{quote}
I can tell you having a \$400~billion home loan book -- your assumptions on unemployment and what’s happening in global interest rates will dwarf whatever assumptions you’ve got on the modelling about the impact of negative gearing by a factor of \dots\ I can’t tell you the number but it’s a big number.
\end{quote}

One concern with downward price pressure is that highly geared investors may end up with negative equity. But given expected one-off price impacts of \TBD{less than 10~per cent},  the risk of negative equity from the tax changes is limited. Only around ten per cent of new property loans go to investors with loan value ratios in excess of 90~per cent.  \TBD{[Impact of new macro-prudential controls]} And ratios for existing loans are falling as property prices continue to grow. For the small proportion of investors that remain highly leveraged, higher interest rates pose a far greater risk than changes to the tax treatment of rental losses.   

Ultimately, the government should not shy away from a sound policy because it generates modest house price corrections. It is incongruous for governments to seek to address housing affordability for new buyers while continuing to offer generous tax breaks to investors that bid up house prices.  

\section{Increases in property taxes will not change rents much}

<<Impact_of_NG_on_house_prices>>=
rental_losses <- 
  sample_files_all %>% 
  filter(Net_rent_amt < 0) %>%
  group_by(fy.year) %>%
  summarise(tot_avg_loss = -1 * sum(as.double(Net_rent_amt * WEIGHT))) %>%
  ungroup %>%
  mutate(real_tot_avg_loss = cpi_inflator(tot_avg_loss, from_fy = fy.year))

NG_tax_exps <-
  sample_files_all %>%
  group_by(fy.year) %>%
  mutate(current_tax = income_tax(Taxable_Income, fy.year = fy.year),
         subseqt_tax = income_tax(ifelse(Net_rent_amt < 0, 
                                         Taxable_Income - Net_rent_amt,
                                         Taxable_Income), fy.year = fy.year),
         diff = subseqt_tax - current_tax) %>%
  group_by(fy.year) %>%
  summarise(avg.diff = sum(diff * WEIGHT))

NG_tax_exps.real <- 
  NG_tax_exps %>%
  ungroup %>% 
  mutate(avg.diff.real = cpi_inflator(avg.diff, from_fy = fy.year)) %$%
  mean(avg.diff.real)

present.value_benefit_from_NG <-
  grattan::npv(rate = 0.042, values = rep(NG_tax_exps.real, 10))

present.value_benefit_from_Quaran_NG <-
  -round(grattan::pv(0.042, 10, sum(just_negative_gearing_taxstats$diff)*weighting(2015)))

housing_finance_commitments.metadata <-
  # This file is Table 8 of Cat. 5671.8 
  ##          WITH CLEANSING          ##
  # the cleansing consisted of
  #   1.  Retrieving the "metadata" rows that link the series ID with things like the 
  #       long name of the series, its frequency and units, etc, and placing them in
  #       sheet "metadata"
  #   2.  Deleting the metadata rows from the main data and placing in a new sheet called
  #       "Data_without_metadata"
  #
  # 
  read_excel("ABSP_567108_Housing_Finance_Table8.xlsx", sheet = "Metadata") %>%
  select_("`Series ID`", "Long_name", "`Series Type`") %>%
  data.table %>%
  setnames(c("series_id", "Long_name", "Series_Type")) %>%
  setkeyv("series_id")

housing_finance_commitments <-
  read_excel("ABS_Cat5671-0_Lending_Finance_Table8_Finance_Commitments_For_housing.xlsx", sheet = "Data_no_metadata") %>%
  gather(series, value, -Date) %>%
  data.table %>%
  setnames("series", "series_id") %>%
  setkey(series_id) %>%
  merge(housing_finance_commitments.metadata)
@

<<What_price_change_req_to_obtain_same_return>>=
res_dwelling_values_metadata <- 
  readSDMX("http://stat.abs.gov.au/restsdmx/sdmx.ashx/GetDataStructure/RES_DWEL_ST/ABS")

recode_res_dwelling_values <- function(DT, colname){
  cls <- slot(res_dwelling_values_metadata, "codelists")
  codelists <- sapply(slot(cls, "codelists"), function(x) slot(x, "id")) 
  
  colname.code <- 
    as.data.frame(slot(res_dwelling_values_metadata, "codelists"), 
                  codelistId = codelists[grep(colname, codelists)]) %>%
    as.data.table %>%
    select(id, label.en) %>%
    setnames(old = "label.en", paste0("label_", colname))
  
  merge(DT, colname.code, by.x = colname, by.y = "id")
}

res_dwelling_values <- 
  readSDMX("http://stat.abs.gov.au/restsdmx/sdmx.ashx/GetData/RES_DWEL_ST/1+2+3+4+5.0+1+2+3+4+5+6+7+8.Q/ABS?startTime=2011&endTime=2015") %>% 
  as.data.frame %>%
  recode_res_dwelling_values("ASGS_2011") %>%
  recode_res_dwelling_values("MEASURE") %>%
  recode_res_dwelling_values("FREQUENCY") %>%
  data.table

res_dwelling_values %>% 
  filter(label_ASGS_2011 == "Australia",
         label_MEASURE == "Value of dwelling stock: Owned by non households ($m)")  %>%
  arrange(obsTime) %>%
  mutate(r = (lead(obsValue)/obsValue)^ifelse(label_FREQUENCY == "Quarterly", 4, NA_real_) - 1) %>%
  arrange(obsTime) %>% invisible

read_excel("ASX_Returns_by_asset_class.xlsx") %>% 
  filter(`Asset class` == "Residential investment property") %$%
  `After tax highest marginal tax rate` / 100 ->
  RoR_proprty

value.of.ng.by.yr <- 
  sample_files_all %>%
  mutate(benefit_due_NG = income_tax(pmax(Taxable_Income, Taxable_Income - Net_rent_amt), 
                                     fy.year = fy.year) -  income_tax(Taxable_Income, 
                                                                      fy.year = fy.year)) %>%
  group_by(fy.year) %>%
  summarise(total_benefit = sum(benefit_due_NG * WEIGHT)) %>%
  ungroup %>%
  mutate(total_benefit_real = cpi_inflator(total_benefit, from_fy = fy.year, to_fy = "2014-15"))

value_of_NG_one_year <- 
  value.of.ng.by.yr %>%
  filter(fy.year == "2012-13") %$%
  total_benefit

value_of_NG_perpertuity <- value_of_NG_one_year / RoR_proprty
value_of_NG_10yrs <-
  -1 * grattan::pv(RoR_proprty, 10, value_of_NG_one_year)

value_dwelling_stock_2014 <- 
  res_dwelling_values %>% 
  filter(label_ASGS_2011 == "Australia",
         label_MEASURE == "Value of dwelling stock: Owned by non households ($m)") %>%
  arrange(obsTime) %$%
  last(obsValue) * 10^6

value_of_dwelling_stock_expected_2025 <- 
  res_dwelling_values %>% 
   filter(label_ASGS_2011 == "Australia",
          label_MEASURE == "Value of dwelling stock: Owned by non households ($m)") %>%
  arrange(obsTime) %$%
  last(obsValue) * 10^6 *  # millions
  (1 + RoR_proprty)^(10)

NG_inflator <- function(n){
  1.028^n
}

value_without_NG <- value_of_dwelling_stock_expected_2025 - value_of_NG_10yrs
change_in_price_due_to_NG_upper <-
  (value_of_dwelling_stock_expected_2025 -  value_without_NG / (1 + RoR_proprty)^10 ) / (value_of_dwelling_stock_expected_2025)





@

<<Owner_occupiers_loans_are_being_outnumbered_by_investors>>=
housing_finance_commitments %>% 
  filter(Long_name %in% c("Owner Occupation (Secured Finance) - Construction of dwellings ;",
                          "Owner Occupation (Secured Finance) - Purchase of new dwellings ;",
                          "Owner Occupation (Secured Finance) - Purchase of established dwellings ;",
                          "Investment housing - Construction of dwellings for rent and resale ;",
                          "Investment housing - Purchase for rent/resale by individuals ;",
                          "Investment housing - Purchase for rent/resale by others ;"),
         grepl("Seasonally", Series_Type)) %>%
  mutate(OwnerType = gsub("^.*((Owner)|(Investment)).*$", "\\1", Long_name)) %>%
  group_by(Date, OwnerType) %>%
  summarise(new_finance = sum(value)) %>%
  ungroup %>%
  arrange(desc(Date)) %>%
  spread(OwnerType, new_finance) %>%
  group_by(Date) %>%
  mutate(prop.owner = Owner/(Investment + Owner)) %>%
  filter(prop.owner != 1) %>%
  grplot(aes(x = Date, y = prop.owner)) + 
  geom_line(aes(group = 1), size = 0.8)
@

<<percent_of_prop_value_due_NG>>=
# Excel chart poorly formatted.
#  read_excel("DAT - Average property tax burden.xlsx", sheet = "Property tax burden", skip = 1, col_types = c())
#  8,223,900.0 

total.value.of.property.2014 <- 
  #8223900 * 10^6  # total value of all property 
  283323.1 * 10^6 # total value of dwellings owned by non-households

pc.prop_val_due_NG <- 
  paste0(round(100*present.value_benefit_from_NG / total.value.of.property.2014), "\\%")
pc.prop_val_due_NG_Quaran <-
  paste0(round(100*present.value_benefit_from_Quaran_NG / total.value.of.property.2014), "\\%")
@


Of all the effects that tax changes on  has on housing markets, its effect on rental prices is by far the most contentious.

Concerns persist that limiting negative gearing and/or reducing the capital gains tax discount will reduce the supply of rental properties and push up rents. These arguments typically rest on two pillars: one, that rental prices rose in the 1980s when negative gearing for property was restricted and two, that investors will abandon the market without present tax advantages. 

The first argument is easily refuted. In 1985, the Hawke Government restricted negative gearing so that rental losses could not be used to reduce tax payable on other income streams.  Two years later, the policy was abolished out of concern for increasing rental prices. 

But these concerns were ill-founded. Rents did rise rapidly in Perth and rose somewhat in Sydney. Yet inflation-adjusted rents were stable in Melbourne and actually fell in Adelaide and Brisbane (Figure 13). In Sydney and Perth it was population growth and insufficient residential construction -- due to high borrowing rates and competition from the stock market for funds -- not the policy change, led to the rent rises. 

<<Capital_city_rents_direct_abs_get, fig.height = 11, out.height = "11in">>=
rsdmx::readSDMX("http://stat.abs.gov.au/restsdmx/sdmx.ashx/GetData/CPI/1.1+2+3+4+5+6+7+8+50.30014.10.Q/ABS?startTime=1982&endTime=1992") %>% 
  as.data.frame ->
  rent.indices

region.decode <- 
  data.table(
    REGION = c(1:8,50),
    city = c("Sydney", "Melbourne", "Brisbane", "Adelaide", "Perth", "Hobart", "Darwin", "Canberra", "AUST CAP")
  )

all.cpi <- 
  data.table::CJ(year = 1982:1990, Quarter = paste0("Q", 1:4)) %>%
  mutate(year_quarter = paste(year, Quarter, sep = "-")) %>%
  mutate(rel = cpi_inflator_quarters(nominal.price = 1,
                                     nominal.date = year_quarter, 
                                     target.date = "1983-Q4"))

cpi_inflator_quarters2 <- function(amount, from, to){
  amount * all.cpi[year_quarter == from]$rel / all.cpi[year_quarter == to]$rel 
}

rent.indices %>%
  merge(region.decode, by = "REGION") %>%
  filter(city %in% c("Sydney", "Melbourne", "Brisbane", "Adelaide", "Perth", "AUST CAP")) %>%
  group_by(city) %>%
  # Why does wrapping up the obs/first(obs) work but not separately? Inflation of an index??
  mutate(obsValuerel = cpi_inflator_quarters(obsValue/first(obsValue), nominal.date = obsTime, target.date = "1983-Q4"),
         obsValuerel = obsValuerel/first(obsValuerel)) %>%
  ungroup %>%
  #mutate(obsValuerel = cpi_inflator_quarters(obsValuerel/first(obsValue), nominal.date = obsTime, target.date = "1983-Q4"))
  mutate(up = city %in% c("Sydney", "Perth")) %>%
  mutate(city = factor(city, 
                       levels = c("Sydney", "Melbourne", "Brisbane", "Adelaide", "Perth", "AUST CAP"),
                       labels = c("Sydney", "Melbourne", "Brisbane", "Adelaide", "Perth", "All\nAustralian\ncapitals"))) %>%
  mutate(obsTime = as.POSIXct(as.yearqtr(obsTime, format = "%Y-Q%q"))) ->
  rent.indices.real
@

<<Capital_city_rents_direct_abs, fig.height = 11, out.height = "11in">>=
rent.indices.real  %>%
  filter(obsTime < as.POSIXct("1989-06-01")) %>%
  # chart_data %>%
  grplot(aes(x = obsTime,
             y = obsValuerel, 
             color = city,
             label = city,
             group = city)) + 
  annotate("rect", 
           xmin = as.POSIXct("1985-07-01"),
           xmax = as.POSIXct("1987-09-30"),
           ymin = -Inf,
           ymax = Inf,
           fill = grey(0.8),
           alpha = 1) + 
  geom_line() + 
  geom_text(aes(vjust = vjust),
            data = mutate(filter(rent.indices.real, obsTime == unique(obsTime)[14]),
                          # manual adjustment of vertical justification
                          vjust = ifelse(grepl("Aust", city), -0.6, 
                                         ifelse(grepl("Brisbane", city), -2.3,
                                                ifelse(grepl("Perth", city),-1.8, -1.1)))),
            hjust = 1, size = 7.14, fontface = "bold",
            lineheight = 0.8) +
  scale_color_manual(values = c(gpal(6)[1:5], "black")) + 
  facet_wrap(~city, ncol = 3)  + 
  theme(strip.text = element_blank(),
        strip.background = element_blank(),
        panel.margin.x = grid::unit(2, "lines"),
        axis.title.x = element_blank())
@

\begin{figure}
\Caption{Rents did not rise when negative gearing was removed in Melbourne, Adelaide or Brisbane}{Average rent prices (real compared with overall CPI), 1982 = 1.
Grey band indicates the dates when negative gearing was not permitted}{fig:Capital_city_rents}
\includegraphics[width=\columnwidth]{\Sexpr{paste0(atlas, "Capital_city_rents_direct_abs-1")}}
\source{\textcite{ABSVariousyearsa}}
\end{figure}

The absence of a detectable rental response is also consistent with overseas empirical studies of the relationship between rents and the tax treatment of investment housing. These studies find that rent increases in response to tax changes are modest  and very slow to take effect, with most impacts not seen for more than a decade. 

Beyond these historical lessons, economic theory predicts that limiting negative gearing should not change rents much. 

Limiting or abolishing negative gearing will reduce the post-tax investment returns for negatively geared property investors. There will be a one-off decrease in house prices as investors reduce their willingness to pay. As house prices fall, rental yields -- rents after tax as a proportion of prices -- will rise at least partially restoring the attractiveness of property investment vis- à-vis other investments. 

Existing negatively geared investors will have larger post-tax losses to service. Some may want to increase rents to maintain their returns. But rents are determined by dynamics of demand and supply, not by the returns that owners are seeking. In property markets -- just like other markets -- returns determine asset prices, not the other way around. Rents do not increase just to ensure that buyers of assets get their money back.

Existing negatively geared investors compete to supply rental properties against other property investors with no imperative to increase rents. Rental incomes for the one-third of landlords making positive rental profits would be unaffected by the tax changes. And new investors would purchase properties at lower prices that factor in the less generous tax treatment of rental losses. Tenants can beat rent rises by threatening to move to properties owned by these other investors. 

Some negatively geared investors may sell their properties if tax concessions are less generous. But in the short term this has no impact on rents.  Every time an investor sells a property to a renter, there is one less rental property, and one less renter. There is no change to the balance between supply and demand of rental properties. Others may sell to another investor, but one that doesn’t rely on negative gearing to make the investment profitable. Again there is no shortage of rental properties. 

Limiting negative gearing could have an impact on rents over the longer term if lower property prices reduce investment in new rental housing. But the effect is unlikely to be large. Currently 93~per cent of all investment property lending is for existing dwellings.  And one-off price impacts of less than XX per cent (Box 5) are unlikely to substantially slow new construction.  

The main constraint on new housing is land release and zoning restrictions -- especially in established suburbs with good access to jobs and transport.    In housing markets with restricted supply, and where locational factors such as transport links and amenities are important determinants of rental demand, then tax changes have little impact on rents even over time. 

In any case, general tax breaks like negative gearing are an inefficient way of supporting the rental market.   Blanket tax concessions for investors that primarily accrue to existing property owners through higher house prices are poorly targeted way of alleviating rental stress.  


\subsection{Capping loss deductions}
<<cost_NG_limited_to>>=
cost_NG_limited_to <- function(Net_rent_amt.limit, h = 0L){
  stopifnot(Net_rent_amt.limit <= 0)
  sample_file_1314 %>%
    taxstats:::project(h = h) %>%
    mutate(new_Net_rent_amt = pmaxC(Net_rent_amt, Net_rent_amt.limit),
           new_Taxable_Income = Taxable_Income - Net_rent_amt + new_Net_rent_amt,
           prev_tax = income_tax(Taxable_Income, "2015-16"),
           new_tax = income_tax(new_Taxable_Income, "2015-16"),
           diff = new_tax - prev_tax) -> resultant_samplefile
  resultant_samplefile %$%
    sum(diff * WEIGHT)
}
@
Capping the total amount of investment losses that can be deducted each
year has been presented as a way to curb the `excesses' of negative
gearing policy.

Capping losses will tend to affect high income earners because they
claim much higher losses on average (section \TBD{3.2}).

The budgetary impact depends on where the cap is set. Table x sets out
the amount of money that could be raised in the longer term if loss
write off against salary and wages is capped annually. Setting a cap on
losses of \$20,000 or more means the policy change will make very little
contribution to the budget bottom line.

<<number_affected>>=
number_affected <- function(Net_rent_amt.limit, h = 0L){
  # Net_rent_amt.limit is understood to be negative
  stopifnot(Net_rent_amt.limit <= 0)
  sample_file_1314 %>%
    # This only affects negative gearers
    filter(Net_rent_amt < 0) %>%
    mutate(new_Net_rent_amt = pmaxC(Net_rent_amt, Net_rent_amt.limit),
           new_Taxable_Income = Taxable_Income - Net_rent_amt + new_Net_rent_amt,
           prev_tax = income_tax(Taxable_Income),
           new_tax = income_tax(new_Taxable_Income),
           diff = new_tax - prev_tax) %$%
    sum(diff != 0) * 50 * lf_inflator_fy(from_fy = "2013-14", to_fy = yr2fy(fy2yr("2013-14") + h))
}

@

<<cost_of_policy_carry_fwd>>=
cost_of_policy_carry_fwd <- function(Net_rent_amt.limit, h = 1L){
  stopifnot(length(Net_rent_amt.limit) == 1)
  if (h > 0){
    probCG <-
      sample_file_1314 %>% 
      filter(Gross_rent_amt > 0) %$%
      mean(Net_CG_amt > 0)
    
    M <- matrix(0, ncol = h, nrow = h)
    M[row(M) == col(M) - 1] <- 1 - probCG
    M[col(M) == 1] <- probCG
    M[1,2] <- 1
    M[1,1] <- 0
    M[h,h] <- 1 - probCG
    
    # require(expm)
    P <- M %^% h
    
    # P[h,j] represents the probabilities of 
    # having (j - 1)*Net_rent_amt in the hth year
    # Expected multiplier
    Ehj <- P[h, ] * seq(0, h - 1, by = 1)
    
    cum.ecdf <- cumsum(P[h,])
    
    accumulator <- 
      data.table(rand = cum.ecdf, 
                 multiplier = seq(0, h-1, by = 1)) %>%
      setkey(rand)
    
    rental_matrix <- 
      matrix(data = c(sample_file_1314$Net_rent_amt, 
                      rep(0, (h - 1) * nrow(sample_file_1213))), 
             ncol = h, 
             byrow = FALSE)
    
    results <- rental_matrix %*% P
  }
  # Net_rent_amt.limit is understood to be negative
  stopifnot(Net_rent_amt.limit <= 0)
  sample_file_1314 %>%
    # This change only affects those who negatively gear.
    filter(Net_rent_amt < 0) %>%
    mutate(rand = runif(nrow(.))) %>%
    setkey(rand) %>%
    # rolling join, if < rand choose that multiplier
    accumulator[., roll = -Inf] %>%
    # inflation
    mutate(Taxable_Income = Taxable_Income - Sw_amt + wage_inflator(Sw_amt, from_fy = "2013-14", to_fy = yr2fy(fy2yr("2013-14") + h))) %>%
    mutate(new_Net_rent_amt = pmaxC(Net_rent_amt, Net_rent_amt.limit),
           accumulated_loss = pmaxC(Net_rent_amt.limit - Net_rent_amt, 0) * multiplier) %>%
    # if the person has a CG event now, they use their accumulated losses against their taxable income
    mutate(hasCG = runif(nrow(.)) < probCG,
           new_Taxable_Income = ifelse(hasCG, 
                                       Taxable_Income - accumulated_loss,
                                       Taxable_Income - Net_rent_amt + new_Net_rent_amt),
           prev_tax = income_tax(Taxable_Income),
           new_tax = income_tax(new_Taxable_Income),
           diff = new_tax - prev_tax) -> resultant_samplefile 
  
  resultant_samplefile %$%
    sum(diff) * 50 * lf_inflator_fy(from_fy = "2013-14", to_fy = yr2fy(fy2yr("2013-14") + h))
}
@

%\caption{Budget impact of cap on loss write-offs}
<<Results, results = 'asis'>>=
long_term = 7L
data_frame(Threshold = c(seq(0, -20e3, by = -5e3), - 50e3, -Inf)) %>%
  rowwise %>%
  mutate(Costing = grattan_dollar(round(cost_NG_limited_to(Threshold, h = 2L))),
         Cost_policy_over_5_yrs = grattan_dollar(round(cost_of_policy_carry_fwd(Threshold, h = long_term))),
         `Number affected` = comma(round(number_affected(Threshold, h = long_term)))) %>%
  mutate(Threshold = paste0("$-\\$", ifelse(is.infinite(Threshold), "\\infty", abs(Threshold)), "$"),
         LongRunCost = sub("$", "\\$", Cost_policy_over_5_yrs, fixed = TRUE),
         Costing = sub("$", "\\$", Costing, fixed = TRUE)) %>%
  select(Threshold, Costing, `Long-run costing` = LongRunCost, `Number affected`) %>%
  xtable(align = "rrrrr") %>% 
  print(include.rownames = FALSE, 
        align = "rrrrr", 
        sanitize.text.function = function(x){x})
@






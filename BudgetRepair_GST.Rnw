\documentclass{grattan}
\LoadMicrotypeFile{cmr}
\SetProtrusion[]  { }%
    { 
      \textendash = { 0,0},      % left protrusion will remain untouched, 
                                % right protrusion set to zero
                                
      {--} = {0,0}
     %\textendash = {150,150},  % this would set protrusion on both sides to 150
    }

\usepackage{tabularx}
<<MODELLING_PARAMETERS, echo=FALSE>>=
# Actually proportion not percentage. i.e. 0.3 = 30%
percentage_of_revenue_to_transfers = 0.3
percentage_of_revenue_to_tax_cuts = 0.3 
old_0910_tax_rates = c(0, 0.15, 0.30, 0.38, 0.45)
#new_0910_tax_rates = c(0, 0.125, 0.30, 0.38, 0.45)
new_0910_tax_rates = c(0, 0.130, 0.29, 0.38, 0.45)
# Please change the numbers to reflect final budget outcomes.

@

<<knitrsettings, echo=FALSE, warning=FALSE, message=FALSE>>=
my_emf <- function(file, width, height){
  devEMF::emf(file, width=width, height=height,
              family = "Arial")
}

my_pdf <- function(file, width, height){
  pdf(file = file, width, height = height)
}

# knitr chunk opts
# fig.width must = out.width and same for out.height
.name.of.file <- knitr:::knit_concord$get("infile")
atlas <- "figure_BudgetRepair_GST/"
knitr::opts_chunk$set(fig.width=11.000, fig.height=7.00, 
                      out.width="11.000in", out.height="7.00in", 
                      fig.show='hide',echo=FALSE,
                      message=FALSE, warning=FALSE
                      ,fig.path = atlas
                      ,cache=F
                      ,error=FALSE  # prevents the pdf being generated when an error is encountered.
                      ,cache.path = "cache_BudgetRepair_GST/"
                      ,dev=c('my_pdf', 'my_emf'
                             #, 'png'
                             )
                      ,fig.ext = c("pdf", "emf"
                                   #, "png"
                                   )
)
chart_data <- NULL
chart_data <- function(.data){
  current_chunk_label <- opts_current$get(name = "label")
  atlas <- atlas
  readr::write_csv(.data, paste0(atlas, "/", current_chunk_label, ".csv"))
}
@

\usepackage{longtable,endnotes}
\input{footnoteToEndnote.tex}
  

\title{A higher or broader GST}
\author{John Daley and Danielle Wood}

\addbibresource{bibliography.bib}
\addbibresource{bibliography2.bib} % r packages

\let\footnote=\endnote
\newcommand{\highlight}{\textbf}
\newcommand*\ie{\emph{i.e.}}
\newcommand*\eg{\emph{e.g.}}
\newcommand*\gao{Grattan analysis of}

<<preamble>>=
library(foreign)
library(survey)
library(readxl)
library(readr)
library(ggplot2)
library(scales)
# for asymmetric expansion of limits
scale_dimension.custom_expand <- function(scale, expand = ggplot2:::scale_expand(scale)) {
  expand_range(ggplot2:::scale_limits(scale), expand[[1]], expand[[2]])
}

scale_y_continuous <- function(...) {
  s <- ggplot2::scale_y_continuous(...)
  class(s) <- c('custom_expand', class(s))
  s
}

scale_x_continuous <- function(...) {
  s <- ggplot2::scale_x_continuous(...)
  class(s) <- c('custom_expand', class(s))
  s
}

scale_x_date <- function(...) {
  s <- ggplot2::scale_x_date(...)
  class(s) <- c('custom_expand', class(s))
  s
}


library(grattan)
library(data.table)
library(tidyr)
library(dplyr)
library(magrittr)
library(xtable)
library(rattle)
library(rpart)
library(stringr)

weighted.var.se <- function(x, w, na.rm=FALSE){
  # Computes the variance of a weighted mean following Cochran 1977 definition
  # http://stats.stackexchange.com/questions/25895/computing-standard-error-in-weighted-mean-estimation
  if (na.rm) { w <- w[i <- !is.na(x)]; x <- x[i] }
  n = length(w)
  xWbar = weighted.mean(x,w,na.rm=na.rm)
  wbar = mean(w)
  out = n/((n-1)*sum(w)^2)*(sum((w*x-wbar*xWbar)^2)-2*xWbar*sum((w-wbar)*(w*x-wbar*xWbar))+xWbar^2*sum((w-wbar)^2))
  return(out)
}
@

%% Functions
<<group_by_income_quintile>>=
group_by.income_quintile <- function(.data, type = "Total_current_weekly_HH_income_from_all_sources"){
  if(type == "Current_weekly_HH_disposable_income"){
    group_by(.data, disposable_income_quintile = factor(as.numeric(cut(Current_weekly_HH_disposable_income, 
                                                            breaks = total.inc.quintiles, 
                                                            include.lowest = TRUE)))) %>%
      arrange(disposable_income_quintile)
  } else {
    if (type == "Total_current_weekly_HH_income_from_all_sources"){
      group_by(.data, gross_income_quintile = factor(as.numeric(cut(Total_current_weekly_HH_income_from_all_sources, 
                                                            breaks = total.inc.quintiles, 
                                                            include.lowest = TRUE)))) %>%
      arrange(gross_income_quintile)
    }
  }
}
@

<<get_sample_file>>=
sample_file_of <- function(year = 2013){
  year <- min(2013, year)
  fy.year <- paste0(year - 1, "-", formatC(year - 2000, flag = "0", width=2))
  # List all files with sample in them that have csv or txt at the end.
  list.of.files <- list.files(path = "./IndividualSampleFile", pattern = paste0("(s|S)ample.*((csv)|(txt))$"), recursive = TRUE, full.names = TRUE)
  return(list.of.files[grepl(fy.year, list.of.files)])
}

get_sample_file <- function(year = 2013){
  colClasses = sapply(fread(sample_file_of(year), nrows=50), class)
  fread(sample_file_of(year), colClasses = colClasses, na.strings = "?")
}
@

<<IND>>=
IND <- function(x, min, max = Inf){
  as.numeric(x >= min) * as.numeric(x < max)
}
@

<<age_mutate>>=

age_mutate <- function(.hes){
  stopifnot("Age_of_HH_reference_person" %in% names(.hes) || "Age_of_person" %in% names(.hes))
  if("Age_of_HH_reference_person" %in% names(.hes)){
    out <- 
    .hes %>%
      mutate(
        age_group = as.character(Age_of_HH_reference_person),
        age_group = ifelse(grepl("^[0-9]+$", age_group), 
                           ifelse(as.numeric(age_group) < 20,
                                  "20 or under",
                                  paste((as.numeric(age_group) %/% 5) * 5,
                                        "to",
                                        (as.numeric(age_group) %/% 5) * 5 + 4)),
                           age_group
        )
      ) 
  }
  
  if("Age_of_person" %in% names(.hes)){
    out <- 
    .hes %>%
      mutate(
        age_group = gsub("\\s+(years)", "", as.character(Age_of_person)),
        age_group = ifelse(grepl("^[0-9]+$", age_group), 
                           ifelse(as.numeric(age_group) < 20,
                                  "20 or under",
                                  paste((as.numeric(age_group) %/% 5) * 5,
                                        "to",
                                        (as.numeric(age_group) %/% 5) * 5 + 4)),
                           age_group
        )
      ) 
  }
  out
}
@

<<income_tax_functions>>=
new_income_tax <- 
  function(income, input){
      LITO <- ifelse(income < input$bracket_2, 445, 
                     ifelse(income < 66667, 445 - ((income - input$bracket_2) * 0.015), 0))
      tax <- ifelse(income < input$bracket_1, 0, 
                    ifelse(income < input$bracket_2, 
                           txmr(input$bracket_1) * (income - input$bracket_1), # from 0.19
                           ifelse(income < input$bracket_3,
                                  txamt(input$bracket_2) + txmr(input$bracket_2) * (income - input$bracket_2), # from 0.325
                                  ifelse(income < input$bracket_4,
                                         txamt(input$bracket_3) + txmr(input$bracket_3) * (income - input$bracket_3), # from 0.37
                                         txamt(input$bracket_4) + txmr(input$bracket_4) * (income - input$bracket_4)))))
      medicare.levy <- ifelse(income <= ML.lower, 0, 
                              ifelse(income > ML.lower & income <= ML.upper, 
                                     0.1 * (income - 20542), 
                                     0.015 * income))
      out <- pmax(tax + medicare.levy - LITO, 0)
      return(out)
    }



new_income_tax_outer0910 <- function(income0910, brackets = c(6000, 35000, 80000, 180000), rates = c(0, 0.15, 0.30, 0.38, 0.45)){
  input <- 
    list(
      bracket_1 = brackets[1],
      bracket_2 = brackets[2],
      bracket_3 = brackets[3],
      bracket_4 = brackets[4],
      #
      rate_1 = rates[1],
      rate_2 = rates[2],
      rate_3 = rates[3],
      rate_4 = rates[4],
      rate_5 = rates[5]
    )
  
  tax_rates <- 
    data.table(
      brackets = c(0, input$bracket_1, input$bracket_2, input$bracket_3, input$bracket_4),
      rates = c(input$rate_1, 
                input$rate_2,
                input$rate_3,
                input$rate_4,
                input$rate_5)
    ) %>%
    mutate(
      tax_amount = NA_real_
    )
  
  # We need to create a table that maps the tax bracket to the
  # tax payable at the bottom of the bracket.  This depends on 
  # the tax brackets and tax rates in the brackets below.
  for (i in 1:nrow(tax_rates)){
    if (i == 1 || i == 2) {
      tax_rates$tax_amount <- 0
    } else {
      tax_rates$tax_amount[i] <-
        tax_rates$tax_amount[i - 1] + 
        tax_rates$rates[i - 1] * (tax_rates$brackets[i] - tax_rates$brackets[i - 1]) 
    }
    
  }
  
  # Convenience abbreviations that takes information from the 
  # previously generated table
  txamt <- function(bracket.lwr){
    tax_rates %>%
      filter(brackets == bracket.lwr) %$%
      tax_amount
  }
  
  txmr <- function(bracket.lwr){
    tax_rates %>% 
      filter(brackets == bracket.lwr) %$%
      rates
  }
  
  new_income_tax <- function(income){
    # We do not adjust LITO.
    LITO <- ifelse(income < 30000, 1350, ifelse(income < 63750, 1350 - 0.04 * (income - 30000), 0))
    tax <- ifelse(income < input$bracket_1, 0, ifelse(income < input$bracket_2, 
                                                      txmr(input$bracket_1) * (income - input$bracket_1), # from 0.19
                                                      ifelse(income < input$bracket_3, 
                                                             txamt(input$bracket_2) + txmr(input$bracket_2) * (income - input$bracket_2), # from 0.325
                                                             ifelse(income < input$bracket_4,
                                                                    txamt(input$bracket_3) + txmr(input$bracket_3) * (income - input$bracket_3), # from 0.37
                                                                    txamt(input$bracket_4) + txmr(input$bracket_4) * (income - input$bracket_4)))))
    medicare.levy <- ifelse(income < 18840, 0, ifelse(income < 22164, 0.1 * (income - 18840), 0.015 * income))
    out <- pmax(tax + medicare.levy - LITO, 0)
    out
  }
  return(new_income_tax(income0910))
}
@

<<latex_percent>>=
latex_percent <- function(x, digits = 3){
  if (length(x) == 0) 
    return(character())
  # x <- reshape::round_any(x, scales:::precision(x)/100)
  x <- round(x, digits)
  
  paste0(ifelse(x < 0, "\U2212", ""), paste0(scales::comma(abs(x) * 100), "\\%"))
}
@

<<HES_and_SIH_cleansing, cache=F>>=
hes10hh_raw <- read.dta("./HES/hes10bh.dta")

hes.sih.vars <- read_excel("./SIH/HES_and_SIH_variable_listing.xlsx") 

# See page 21 of HES 2009-10 user guide
# http://www.ausstats.abs.gov.au/ausstats/subscriber.nsf/0/1D03ACBBD40275ADCA257A3900173E85/$File/65030_1.pdf
hes.sih.vars %<>%
  mutate(Definition = ifelse(HES_basic_name == "COICEXP", paste0(Definition, "_COICOP"), Definition))

hes.sih.vars %<>%
  gather(GROUP, variable, -Definition) %>%
  mutate(variable = gsub("[^A-Za-z0-9]", "", variable)) %>%
  filter(complete.cases(.)) %>%
  spread(GROUP, variable) %>%
  mutate(
    # replace all nonletters with _ unless they occur at the end of the name,
    # in which case delete it
    Definition_new = gsub("[^A-Za-z]+(?!$)", "_", Definition, perl = TRUE),
    Definition_new = gsub("[^A-Za-z]+$", "", Definition_new)
  )

hes10hh.names <- 
  hes.sih.vars$HES_basic_name[hes.sih.vars$HES_basic_name %in% names(hes10hh_raw)]
hes10hh.newnames <-
  hes.sih.vars$Definition_new[hes.sih.vars$HES_basic_name %in% names(hes10hh_raw)]

hes10hh <-
  hes10hh_raw %>%
  # This omits some weights and PETTAX (hh consumption of fuel tax) for some reason
  select_(.dots = hes10hh.names) %>%
  data.table %>%
  setnames(old = hes10hh.names, 
           new = hes10hh.newnames)

hes10hh %<>%
  mutate(
    Age_of_HH_reference_person = factor(gsub(" years",
                                             "",
                                             Age_of_HH_reference_person))
  ) 

disp.inc.percentiles <- 
  hes10hh %>%
  svydesign(~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Current_weekly_HH_disposable_income # disposable income
              ,.
              ,quantiles = c(0:100)/100)
disp.inc.deciles <- 
  hes10hh %>%
  svydesign(~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Current_weekly_HH_disposable_income 
              ,.
              , quantiles = c(0:10)/10)

total.inc.percentiles <- 
  hes10hh %>%
  svydesign(~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Total_current_weekly_HH_income_from_all_sources 
              ,.
              , quantiles = c(0:100)/100)

total.inc.deciles <- 
  hes10hh %>%
  svydesign(~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Total_current_weekly_HH_income_from_all_sources 
              ,.
              , quantiles = c(0:10)/10)

total.inc.quintiles <- 
  hes10hh %>%
  svydesign(~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Total_current_weekly_HH_income_from_all_sources 
              ,.
              #, quantiles = c(0:5)/5)
              ,quantiles = c(0:5)/5)


hes10hh %<>%
  mutate(income.percentile = factor(as.numeric(cut(Current_weekly_HH_employee_income, 
                                                   breaks = disp.inc.percentiles, 
                                                   include.lowest = TRUE)))) 

hes10_indiv_raw <- 
  read.dta("./HES/hes10bp.dta")

hes10hp.names <- 
  hes.sih.vars$HES_basic_name[hes.sih.vars$HES_basic_name %in% names(hes10_indiv_raw)]
hes10hp.newnames <-
  hes.sih.vars$Definition_new[hes.sih.vars$HES_basic_name %in% names(hes10_indiv_raw)]

hes10_indiv <- 
  hes10_indiv_raw %>%
  data.table %>%
  select_(.dots = hes10hp.names) %>%
  setnames(old = hes10hp.names, 
           new = hes10hp.newnames)

total.inc.deciles_indiv <- 
  hes10_indiv_raw %>%
  svydesign(~ABSPID, data = ., weights = ~HESPSWT) %>%
  svyquantile(~INCTSCP8 # total weekly income from all sources
              ,.
              , quantiles = c(0:10)/10)

total.inc.quintiles_indiv <- 
  hes10_indiv_raw %>%
  svydesign(~ABSPID, data = ., weights = ~HESPSWT) %>%
  svyquantile(~INCTSCP8 # total weekly income from all sources
              ,.
              , quantiles = c(0:5)/5)
@





\begin{document}
\contentspage

\begin{summary}
Since its introduction in 2000, proposals to extend or broaden Australia's 10 per cent goods and services tax (GST) have been a perennial in the tax reform debate in Australia. Current governments face many challenges, such as funding growing healthcare costs, reducing deficits, and cutting inefficient taxes. A higher GST could fund any of these initiatives -- although perhaps not all of them. 

Raising more money through raising the GST or applying it to more things is preferable to most of the other revenue-raising alternatives. A broad based tax on consumption is one of the least damaging taxes to economic growth. Broadening the GST base to include fresh food, health and education would reduce distortions and compliance costs compared to its current narrow coverage. But increasing the rate of the GST is a satisfactory second best.

\textbf{Extending the GST} to cover many of the categories currently exempt could raise almost \textbf{\$20~billion} per year. While \textbf{increasing the rate to 15 per cent} would generate around \textbf{\$27~billion}. 

The regressive impacts of a broader or higher GST can be mitigated by higher welfare payments and targeted tax cuts. The welfare and tax changes we propose protect the most vulnerable while also minimising the economic cost of the changes. 

New household-level modelling informs our proposed compensation package. Spending around \highlight{30 per cent of the additional revenue from a broader or higher GST on higher welfare payments} would leave most of the bottom 20 per cent of income earners better off. And increases in welfare payments can be structured so for most recipients there is no change in their incentive to work. 

A major concern with this approach is that compensating welfare payments may be eroded over time. Overcompensation of the most vulnerable recipients should help ease this concern: a substantial boost to payments, even if eroded over time, could leave many recipients better off than otherwise for many years.

Modest income tax cuts are also part of our proposed package. Channelling a further \highlight{30 per cent of additional revenue} to income tax cuts will allow the government to shave \highlight{1 to 2.5 percentage points} off the bottom two tax rates. Tax cuts of this magnitude fully offset the increase in GST for most low and middle income households -- those earning up to \$100,000 a year -- while also providing some benefit for those further up the income distribution. These tax cuts will maintain and even increase work incentives for low to middle income taxpayers, who are most responsive to changes in effective tax rates. 

However, not everyone can be fully compensated. Government budgets are in deficit, and it is neither politically nor practically feasible for governments to bridge the gap purely with spending cuts. Around \highlight{40~per~cent of the additional revenue} from a higher or broader GST \highlight{(between \$7 to \$11~billion)} would be left over after welfare increases and middle income tax cuts. At least some will need to go to state governments to help them address their looming hospital funding gap, as the price for their cooperation in the changes. This will leave a little -- but not much -- to reduce the Commonwealth's budget deficit, or to pay for other tax cuts that will promote economic growth. 
\end{summary}

\chapter{Australia should raise more from the GST}\label{chap:Chapter1}
Commonwealth and state government budgets are under pressure.\footcite{daleywood2015fiscalchallenges}  The Commonwealth Government has run deficits for six years, with another four forecast. And state governments face looming pressures because spending in health and education is growing faster than GDP.

Tax changes that increase revenue collections will need to be part of the solution. In this context, Grattan is releasing a series of papers outlining revenue measures that government should adopt to improve their fiscal position.  Increasing revenues from the GST, if well executed, would be a fair way to increase revenue collections without too much drag on the economy. 


\section{Australia's GST is low relative to overseas}
The GST is a 10 per cent consumption tax levied on final consumption of all goods and services other than fresh food, health, education, water, childcare, financial services, rent and a few other smaller expenditure categories. 

GST revenues are collected by the Commonwealth Government and are then distributed to State Governments as untied grants. The GST is distributed according to determinations of the Commonwealth Grants Commission, which tries to ensure that States have resources to provide services at them same standard as each other.\footcite[p.~12]{CommonwealthGrantsCommission2015}

The GST raised \$54~billion in 2014-15.\footcite[p.~4-16]{Budget2015} This was around 12~per cent of government revenus in Australia -- well below the average of 20~per cent for all OECD countries.\footnote{The OECD average was 19.5 per cent in 2012 (See: \textcite{OECD2014})} \dots\ Indeed, Australia relies less on broad-based consumption tax to raise revenue than all but two OECD countries.\footnote{The exceptions are Japan and the United States (which does not have a broad-based consumption tax) \textcite[p~40]{OECD2014} }  Australia's GST only covers about 47 per cent of consumption, below the OECD average of 55 per cent, and well below New Zealand where the GST covers 96 per cent of all goods and services consumed.\footnote{\textcite[p.~95]{OECD2014} . The OECD calculates its consumption tax coverage ratio based on the difference between consumption tax revenue actually collected and what would be theoretically raised if consumption tax were applied at the standard rate to the potential tax base in a `pure' consumption tax regime.} 

Not only are Australia's revenues from broad-based consumption taxes low by international standards, they are shrinking relative to the economy. In the decade to 2014-15, GST revenues fell from almost 4.0 to 3.4 per cent of GDP.  Households saved more of their incomes, and spent more of their incomes on GST-exempt items, particularly housing (\Vrefrange{fig:Households_are_saving_more}{fig:Spending_less_on_GST_liable}).

There is no obvious reason for these trends to reverse in the foreseeable future. Savings rates are now close to long-run averages with low savings rates in the early 1990s and 2000s looking like a historical anomaly (\Vref{fig:Households_are_saving_more}). The proportion of incomes spent on health is forecast continue to grow.\footcite[p.~28]{Daley2014} 

And the proportion of incomes spent on housing may well also continue to increase, as land supply is finite, and new housing supply is struggling to meet the demands of a growing population. \footnote{Ultimately the path of prices will depend on population growth, household size and whether supply of new properties keeps pace with the growth in demand. \textcite[p.~7]{RBA2014}} The GST has not been, and may never entirely be the ``growth" tax the states were originally promised.\footcite{Costello2000}

\begin{figure}
<<Households_are_saving_more>>=
# Not to be QCd
read_excel("Households_are_saving_more.xlsx") %>%
  setNames(c("Year", "prop_savings_by_HH_disp_inc")) %>%
  mutate(Year = as.Date(paste0(Year, "-01-01")),
         prop_savings_by_HH_disp_inc = prop_savings_by_HH_disp_inc / 100) %>%
  #
  grplot(aes(x = Year, y = prop_savings_by_HH_disp_inc, group = 1)) + 
  geom_line() + 
  scale_y_continuous(label = percent,
                     limits = c(0,0.2),
                     expand = c(0,0)) +
  theme(axis.title = element_blank())
@
\Caption{Households are saving more again\dots}{Savings as a percentage of household disposable income}{fig:Households_are_saving_more}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/Households_are_saving_more-1}
\notes{}

\source{}
\end{figure}
\begin{figure}
<<Spending_less_on_GST_liable>>=
# Not to be QCd.
read_excel("Final_consumption_expenditure_by_GST_category_1999-2015.xlsx", sheet = "For_output") %>%
  gather(category, share_of_consumption, -Date) %>%
  mutate(super_category = ifelse(category == "GST_applicable", "GST applicable",
                                 ifelse(category %in% c("Housing", "Financial"), "Remain exempt", "Proposed inclusions"))) %>%
  group_by(category) %>%
  mutate(share_of_consumption_indexed = 100*share_of_consumption/first(share_of_consumption),
         #cosmetic
         label.text = ifelse(Date == last(Date), as.character(category), NA_character_),
         label.text = gsub("[^a-zA-Z]", " ", label.text)) %>%
  ungroup %>%
  # cosmetic
  mutate(Date = as.Date(Date)) %>%
  #
  grplot(aes(x = Date, y = share_of_consumption_indexed, group = category, color = super_category)) + 
  geom_line() + 
  # stat_smooth(se = FALSE, size = 1.5) + 
  geom_text(aes(label = label.text),
            hjust = -0.05, fontface = "bold",
            size = 7.14,
            show_guide = FALSE) + 
  scale_color_manual("", values = gpal(6)[c(1,5,3)]) + 
  scale_y_continuous(limits = c(80,160), expand = c(0,0)) + 
  scale_x_date(expand = list(c(0,0.27), c(0,0.0))) + 
  guides(color = guide_legend(keywidth = 3, keyheight = 2)) + 
  theme(axis.title = element_blank(),
        legend.position = c(0.20, 0.90),
        legend.text = element_text(size = 23),
        legend.key = element_blank()) 
@
\Caption{\dots\ and spending less on GST-liable goods and services.}{Consumption as a share of final consumpiton, 1999 = 100}{fig:Spending_less_on_GST_liable}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/Spending_less_on_GST_liable-1}
\notes{}

\source{}
\end{figure}


\section{Consumption taxes are less bad than many other taxes}
Consumption taxes such as the GST are relatively efficient taxes. They are relatively difficult to avoid,\footcite[p.~274]{Treasury2010}  and they encourage saving more than personal income taxes.\footnote{A consumption tax treats current and future consumption equivalently so there is no distortion in savings decisions. In contrast, income tax places a higher burden on savers because households pay tax on their income (regardless of how much they save) and then taxes the capital income on savings again in the future. See: \textcite{Treasury2010} However, the tax rate on savings makes relatively little difference to savings decisions of high-income earners who do most of the saving: see \textcite{DaleySuperannuation2015}}  They drag less on economic efficiency than many state government taxes including payroll taxes\footnote{While theoretically broad based payroll taxes and consumption taxes are equivalent, the range of exceptions and thresholds provided by state government for payroll taxes have considerably increased their efficiency costs.}  and stamp duties.\footcite{DaleyCoates2015Property} 

An increase in consumption tax in effect acts as part a lump sum tax on accumulated wealth, and so collects more from households such as retirees that are living from savings and income from investments. Such households otherwise contribute less to tax collections, and their contribution relative to younger households is falling as a result of age-based tax-free thresholds, and superannuation tax breaks.\footcite{Daley2014}  Our \textit{Wealth of Generations} report showed that households over 55 pay much less tax on average than younger households, despite much higher wealth.\footcite[p.~27]{Daley2014}  

Income taxes can affect the incentives to work more than consumption 
taxes. The combination of income tax scales and the withdrawal of means 
tested welfare benefits can discourage working because they result in 
low rates of take home pay. The disincentives are larger for low-income 
workers and those working part time (\Vref{box:labour_supply}). Higher income tax rates as 
a result of bracket creep can materially reduce workforce participation 
of middle income part-time earners.

Consumption taxes can affect incentives to work less than income taxes. The combination of income tax scales and the withdrawal of means tested welfare benefits can discourage working because they result in low rates of take home pay. The disincentives are larger for low-income workers and those working part time (\Vref{box:labour_supply}).\footnote{\textcites{Commission2015}{Harding2009}{ReferenceGroupToMinisterForSocialServices2015} which recommended mechanisms to improve these incentives.}  Higher income tax rates as a result of bracket creep can materially reduce workforce participation of middle income part-time earners.\footcite[p.~6]{daleywood2015fiscalchallenges} 

Consumption taxes do discourage work to some extent, because wages buy less once the consumption tax is taken into account.\footcite{PicosSanchez2011}  However, consumption taxes may discourage working less than income taxes because their impact on spending power is less obvious. Consumption taxes are less salient: there is some experimental economics evidence that people notice nominal wages (due to income tax) more than lower real wages (due to a consumption tax).\footnote{\textcites{Blumkin2012}{SausgruberTyran2005}  This is because of the `money illusion': individuals tend to think in nominal rather than real terms.} 

Overall, higher consumption taxes should cause fewer problems than higher income taxes. Overall incentives to work can be improved if income tax cuts introduced with the GST are targeted at low and middle brackets (\Vref{box:labour_supply}). 
And potential disincentives to work from higher welfare benefits to compensate poorer households for a higher GST can be managed by the design of these measures (\Vref{chap:targeted_comp_pkg}). 

\begin{smallbox}[tbp]{Impact of taxes on labour supply}{box:labour_supply}
There is a comprehensive literature on the effect of taxes on labour supply decisions. In \textcite{Mirrlees2011}, \textcite{meghir2008labour} provide a summary of this work and nominate the findings for which there is consensus or near consensus. 

Almost all the relevant studies find that men's hours of work are relatively unresponsive to tax changes. This is because most men work full-time. But for men with low levels of education, the decision of whether to work is somewhat affected by tax and welfare incentives. For highly educated men, tax rates make almost no difference to their work decisions. However, tax rates do affect their taxable incomes: high-income taxpayers are more likely to convert income into non-taxable forms when tax rates are high.  

On the other hand, empirical studies invariably find that tax and welfare benefits have a much greater bearing on working decisions for women with young children, particularly single mothers -- affecting both the decision to work and the number of hours chosen.  

Taken together, the studies suggests that the people whose labour supply decisions are most responsive to changes are those on low and middle incomes deciding whether to work or whether to increase their hours of work. If one objective of tax reform is to increase workforce participation, then tax cuts should focus on the low to middle brackets.
\end{smallbox}


\chapter{A broader base, or a higher rate?}
GST revenue collections can be increased either by broadening the range of items that are subject to the tax (`broadening the base') or by increasing the rate above the current 10 per cent. Broadening the base is generally favoured on pure policy grounds because it is simpler and more efficient. But increasing the rate could be a satisfactory `second best'; if it is too politically difficult to broaden the base. 

\section{The GST could be broadened to several categories}
Australia's GST covers just over 40 per cent of the potential consumption base. This is well below the OECD average of 55~per~cent (\Cref{chap:Chapter1}).

There are a range of expenditure categories currently exempt from the GST.\footnote{The OECD draws a distinction between goods and services taxed at reduced rates, including a zero rate, and goods which are exempt (input-taxed). Under this classification, in Australia, health, education, fresh food, water and childcare are taxed at a reduced (zero) rate and financial services and housing are exempt (see text for further discussion of input taxation).}
Broadening the base to include fresh food, education, health, water and sewerage could raise almost \$20 billion (\Vref{fig:GST_revenue_of_excluded_items1415}). This figure takes into account the effects of changes in consumer behaviour due to the increased prices in these categories. 
\begin{figure}
<<GST_revenue_of_excluded_items1415>>=
# Not to be QCd
gst.expenditures <- read_excel("GST_expenditures1415.xlsx")

gst.expenditures %>%
  mutate(Category = factor(Category)) %>%
  grplot(aes(x = Category, y = Tax_expenditure, fill = Scope, order = Order)) + 
  geom_bar(stat = "identity")  + 
  geom_text(aes(label = Tax_expenditure), hjust = -0.25, size = 7.14) + 
  scale_x_discrete(limits = gst.expenditures$Category[order(gst.expenditures$Order)] ) +
  scale_y_continuous(label = grattan_dollar, expand = list(c(0,0), c(0,0.5))) + 
  coord_flip() + 
  ylab("Tax expenditure (bn)") + 
  scale_fill_manual(values = gpal(2, dark=TRUE)) + 
  theme(panel.grid = element_blank())
@
\Caption{Including fresh food, health, education, and other categories in the GST could raise over \$20 billion}{Potential GST revenue of excluded items, 2014-15}{fig:GST_revenue_of_excluded_items1415}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/GST_revenue_of_excluded_items1415-1}
\notes{Excludes revenue gain from housing as comparable estimates are not available.}

\source{\textcite{Budget2015}}
\end{figure}

This would leave exemptions in place for financial services, existing residential housing, and some other smaller spending categories.\footnote{These include supplies by charitable organisations and administrative exemptions, from example for very small businesses. \textcite{Treasury2014}}  These are currently `input taxed'. Financial service providers pay GST on their inputs but do not charge GST to customers.\footnote{\textcite[p.~169]{Treasury2014}  The result is that households are under-taxed because there is no tax on the value-added component of financial services and businesses are over-taxed because they cannot claim GST offsets for the embedded taxes they pay on these services. Ultimately, the goal should be to tax financial services in the same way as other consumption to remove this distortion. Freebairn (2013); Treasury (2010), p. 52.} Similarly, home owners pay GST on the costs of maintaining and upgrading their house but there is no GST levied on the `imputed rents'. GST is not applied on rents for investment properties to maintain neutrality between owner occupiers and investors. 

Taxing the full value added by these services would be complex. It is not easy to determine the appropriate margin on which to calculate the tax. For these reasons, these categories are excluded from value added tax in almost every OECD country.\footcite[p.~21]{OECD2014}

For financial services, the South Australian Government has proposed a ``financial institutions duty'' which is broadly equivalent to the GST but easier to implement.\footnote{\textcite{Evans2015}. See also \textcite{Weatherill2015}}  The duty is a supplementary tax on the margins between the rates charged by financial institutions and the rates at which they borrow. There remains some administrative complexity -- for example, determining the best way to exclude business banking -- but it is worthy of consideration as a way to tax the ``value added'' from financial services.

The Government has already announced proposed changes to the GST treatment of imports from 1 July 2017. Imports worth less than \$1000 are currently exempt from the GST. Under the new policies, GST will apply to all imported digital goods and services and physical goods.\footnote{In other words, the value threshold is set at zero. The measure to include GST on cross-border supplies of digital goods and services was included in the May 2015 Budget \textcite[p.~20]{Budget2015}. The Government announced a policy to charge GST on cross-border supplies of physical goods under \$1000 following agreement with the State and Territory treasurers at a meeting in August 2015. \textcite{Hockey2015}.}  The requirement to collect and remit GST will be imposed on the overseas vendor. As for domestically produced goods and services, only vendors with an Australian turnover of \$75,000 will need to register for and charge the GST. 

The policy imposes a fixed cost on overseas retailers selling to Australians, as they would need to implement systems that apply specifically to any purchaser based in Australia. This impost would be relatively small for retailers that sell large volumes to Australians, like Amazon and Netflix. Some of these have already suggested they will register for the GST.\footnote{Netflix indicated they will continue to comply with local tax obligations. Apple already charges GST on its digital downloads in Australia. \url{http://www.afr.com/technology/web/joe-hockey-flags-netflix-tax-in-gst-extension-20150409-1mhhed}} However, it is not clear the legal recourse available to the government if overseas vendors do not choose to register.\footnote{The Low-Value Parcel Processing Taskforce that explored this issue in 2012 said that GST obligations imposed directly on international suppliers would ``likely be non-enforceable, and hence rely on voluntary cooperation by suppliers'' (Treasury (2012b), p. 139).} The former Treasurer Joe Hockey argued that ``global pressure'' would force retailers to comply. 

Any system that requires Customs to verify GST compliance and charge consumers where the supplier is non-compliant will be expensive to administer. Previous reviews found inspecting packages at the border costs much more money than it raises in additional tax, particularly for low values of the threshold.  This is because most imports below the current \$1000 threshold are low value items. Credit-card transaction data suggests that 90 per cent of imports of less than \$1000 cost less than \$100 and 49 per cent cost less than~\$10.\footcite[p.~1]{NAB2013} 

\subsection{Increasing the GST rate}
An alternative to broadening the base of the GST is to increase the rate. Australia's 10 per cent rate is low by international standards. It is the fourth lowest value added tax rate in the OECD, and considerably below the OECD average of 19 per cent. 

Increasing the rate of the tax from 10 to 15 per cent could raise as much as \$27 billion, based on GST collections in 2014-15. This does not factor in behavioural change, although it is unlikely that much revenue will be lost because people shift their spending towards goods and services in exempt categories.  As discussed in \Vref{box:ChangeInConsumerChoices}, consumption of GST exempt categories (particularly fresh food, health and education) is not affected much by their price relative to other goods and services.


\subsection{Broadening the GST will make it simpler and more efficient}
A broader base for consumption taxes minimise distortions in decision making. By taxing purchases of all goods and services at the same rate, people consume whichever goods and services that provide them with the most value. When differential tax rates apply then there are welfare losses; people are induced to consume relatively more of the lower taxed goods and less of the higher taxed goods than they would otherwise prefer.\footcite{AtkinsonStiglitz1976} This is particularly true when different tax treatment is applied to goods or services that are substitutes. For example, remedial massage attracts GST while both osteopathy and chiropractic services are GST free.  Broadening the GST would remove these distortions.  

There are other reasons to favour a broad based tax. Exemptions create administrative costs for businesses that deal with both exempt and non-exempt goods. And grey lines create opportunities for tax avoidance and lobbying to exclude particular goods.\footnote{}  While arguably a lot of these costs have already been sunk, new fronts in the debate open up from time-to-time.  

A majority of senior Australian economists favoured broadening the base of the GST rather than increasing the rate. Most thought it would increase efficiency and simplicity. In contrast, the one third that disagreed (the balance were undecided) were either sceptical about the net efficiency gains or had doubts that compensation would be adequate to address the effects of a more comprehensive GST for those on low incomes. 

Including spending on education and health in the GST will also help address the problem of ``base erosion.'' Spending on health in particular is expected to rise faster than income (section 1.1). Including health and education in the GST base will ensure revenues from the tax better keep pace with economic growth, as well as aligning more closely with state government expenditures. 


\subsection{Social purposes of existing exemptions could be served better by other means}

Some defend the existing exemptions because they send consumers worthwhile price signals to consume more healthy fresh food and to spend more on private health and education in ways that reduce the pressures on the public systems. 

However, GST exemptions are an inefficient way to pursue these ends. There are any number of goods and services the government might want to promote or deter. But the tax system is a blunt instrument for fine-tuning consumption habits. There are few items with market failures so large that they justify governments imposing differential tax treatment despite the efficiency costs.\footcite{Mirlees2011}  For these items, government can design `sin taxes' specifically aimed at the problems.\footnote{In these examples the purpose of the taxes is to change relative prices and therefore behaviour rather than to simply raise money.}
For example, if governments want to use taxes to encourage better diet, then a high tax rate targeted at foods high in sugar and salt would be much more effective than a relatively small shift in the price of all processed food.\footnote{For example, the Australian Government's \textcite[p.~15]{PreventativeHealthTaskforce2008} recommend a review of taxation consider increasing taxes on energy dense foods.}
In any case, empirical evidence indicates that there would be relatively little change in consumer behaviour if government broadened the GST to include fresh food \Vref{box:ChangeInConsumerChoices}.

Others argue that a GST on private health and education services will give public providers an advantage over private providers. But governments don't aim for a level playing field in health and education: they explicitly provide higher subsidies for those using the public systems. 

A more serious objection is that charging GST on private health and education could reduce total government revenue if it led people to switch from less subsidised private services to more subsidised government services. But the evidence suggests that switching would be limited (Box 1). Further for schools, it is now less clear that the government subsidy provided to private schools is substantially less than the subsidy for public schools once the relative disadvantage of the student base is taken into account.\footnote{A unpublished study using using MySchool data to adjust for relative disadvantage suggests that Catholic private schools receive only slightly less (and in some cases more) government funding per student for a given range of student disadvantage. Other independent schools receive somewhat less but the gap is decreasing over time. \textcite{Bonner2015}} 

\begin{bigbox*}{Change in consumer choices due to a broader GST}{box:ChangeInConsumerChoices}
Broadening the GST will increase the relative price of fresh food and private health and education services. But empirical evidence suggests that behavioural changes could be modest. 
Treasury finds that demand in the fresh food category is inelastic, so that a price rise will not lead to much change in consumption. It estimates that a 10 per cent increased tax on food would only reduce consumption by 1.6 per cent (Treasury (2014)). 

A study by the Rural Industries Research and Development Corporation using data from the ABS Household Expenditure Survey also concluded that demand for fresh foods such as milk, bread and fresh vegetables are relatively unresponsive to relative price changes. The estimates suggest that a 10 per cent increase in price for a particularly item would reduce consumption by between 2 and 7 per cent. For fresh fruit, consumption is estimated to fall proportionately with the price rise (Ulubasoglu et al. (2011)). Because these estimates look at changes in demand from price rises for particular food categories in isolation, they will overstate the degree of substitution from an across the board increase in fresh food prices.

Studies of private health insurance in Australia and internationally have found that consumers are not very responsive to price changes. Estimates of the price elasticity of supplementary private health insurance (insurance that provides more choice or faster access relative to universal health care) range from $-0.2$ and $-0.5$, suggesting that demand would fall less than 5 per cent in response to a 10 per cent GST (Cheng (2013)). Another study calculates that the price elasticity of health insurance in Australia would need to be $-1.43$ for rebates to be self-financing, suggesting that switching to the public sector will not come close to eliminating revenue gains (Frech and Hopkins (2004)). This is perhaps unsurprising given policies like lifetime health cover loading and the Medicare levy surcharge provide a strong incentive for those above 30 and/or on higher incomes to maintain cover (ATO (2015)).

Treasury estimates that demand for medical and health services may only fall as little as 1.5 per cent in response to a 10 per cent GST. However, the government may face pressure to decrease co-payments for some health services if price increases disproportionately impact on disadvantaged groups. This would somewhat offset potential revenue gains from applying the GST to these services. 

Treasury's elasticity estimate for private education services is close to one but this includes the effects of reductions in demand for discretionary courses for which students are less likely to switch to public providers. Historical trends in Australian private school enrolments suggest that parents are not particularly price sensitive. Between 1990 and 2007, average fees roughly doubled in real terms for both Catholic and Independent schools. During this period their enrolment share increased by around two and five percentage points respectively (Nous Group (2011)). 


\end{bigbox*}

% \section{Increasing the GST rate}
% An alternative to broadening the base of the GST is to increase the rate. Australia's 10 per cent rate is low by international standards. It is the fourth lowest value added tax rate in the OECD, and considerably below the OECD average of 19 per cent.\footcite{PublicFinance2014}
% 
% Increasing the rate of the tax from 10 to 15 per cent could raise as much as \$27 billion. This does not factor in behavioural change, although revenue leakage from substitution to exempt categories is likely to be limited.\footnote{While a higher GST will lead to some distortion in economic activity because of substitution to exempt categories this will be limited because the tax applies to most goods. \textcite{Econotech2011}}
% As discussed above, consumption of GST exempt categories (particularly fresh food, health and education) is not affected much by their price relative to other goods and services.
% 
% For the efficiency and simplicity reasons discussed above broadening the base would be better than raising the rate. 

\chapter{A targeted compensation package}\label{chap:targeted_comp_pkg}
Opposition to increasing Australia's GST is often motivated by concerns about the impacts on low-income households. If we are to protect the disadvantaged, compensation is required to ensure that low-income people are not significantly out of pocket. The package should also maintain incentives for workforce participation, particularly for low and middle income earners who are most responsive to changes in effective tax rates. This means a combination of tax cuts and higher welfare payments. 

But if the GST package is partly to provide revenue to State Governments to fund growing health and education spending,\footnote{The decision in the 2014-15 Commonwealth budget to withdraw from the National Health Reform Agreement and to no longer fund growth in hospital spending precipitated the current discussion (including the support from the NSW Government) for the government to increase the GST. \textcite[p.~18]{daleywood2015fiscalchallenges}}
then it must be revenue positive. Some people will need to pay higher net taxes. Even if the package is budget-neutral, the political need to over-compensate low-income households to protect disadvantaged will lead to some other households paying more tax in total.

This will be difficult for governments that have been accustomed to `buying' reform. The GST and the Carbon Pollution Reduction Scheme were both accompanied by a package of generous tax cuts and increases to welfare benefits (\Vref{box:BuyingReform}). The history of responding to demands that there be `no losers' has changed the political economy of reform. Politicians have arguably become less adept at prosecuting the case for difficult changes.\footcite[p.~80]{Megalogenis2010} 
And the public have come to expect that medicine will always arrive with a spoonful of sugar.\footcites{Megalogenis2010}{Henry730}
%Ken Henry, 7.30 report. Australian Broadcasting Corporation
%Broadcast: 22/09/2015 Reporter: Leigh Sales http://www.abc.net.au/7.30/content/2015/s4317759.htm
But without revenue positive reforms, the budget pressures we outlined in our \emph{Fiscal Challenges} paper will only continue to deteriorate. 

Our proposed package balances the need for fiscal consolidation with fairness and efficiency. It overcompensates the bottom 20 per cent of the income distribution on average, mainly through higher welfare payments. So most of the poorest Australians will be no worse off, and the majority better off, in terms of their real purchasing power. Modest tax cuts focussed on the low and middle thresholds would maintain or improve the incentives for work participation and ensure that most low and middle income earners are also better off. Around 40 per cent of the additional revenue would be left over. The potential uses of this are discussed in \Vref{chap:UsesOfGSTRevenue}. 

\begin{bigbox*}{Buying reform -- the GST and CPRS compensation packages}{box:BuyingReform}
The introduction of the GST in 2000 was accompanied by cuts to personal income tax and increases in welfare benefits. 

Personal income tax changes costing around \$13 billion a year included an increase in the tax free threshold, a reduction in tax rates at the lower end and an increase in the threshold for the top marginal tax rate. 
The objective of this consumption tax/income tax `swap' was to improve the efficiency of the tax system by improving incentives for work.

An across the board 4 per cent increase in pensions and other social security payments  were also introduced to compensate welfare recipients for higher prices following the introduction of the GST. These increases cost around \$2 billion in 2002-03. 

More significant changes were also introduced for family payments, at a cost of around \$2.5 billion a year. Higher payments were designed to compensate for the higher cost of living following the GST and to provide greater recognition of the costs of raising a family. 

The amount of revenue raised by the GST in 2002-03 was around \$30 billion. So households on average were overcompensated once the abolition of \$25 billion in other taxes, tied to the introduction of the GST, are taken into account. 


The government claimed the package would make everyone better off but the middle class particularly benefited because of the structure of the tax cuts. And inequality was somewhat increased by the package. \textcite{Saunders2004} shows inequality measured by incomes at the 10th percentile relative to the 90th percentile increased markedly in the year following the introduction of the GST.

In contrast, the compensation package for the CPRS pushed money towards those at the bottom of the income distribution. 

Around half the \$4 billion revenue from the first year of the CPRS was handed over to households as compensation.  
The compensation package included higher family payments and pensions and tax cuts to all taxpayers earning up to \$80,000. The assistance package actively targeted households at the lower end of the income distribution, with the goal of fully offsetting the cost of living increases for low-income households and helping meet the increases in costs for middle-income households. 

Around 90 per cent of households received some compensation. There was also a fund to ease transition costs for business and community sector organisations. Overall the package over-compensated households for the increases in living costs; with average assistance of \$10.10 per week compared to average cost increases of \$9.90. 
\end{bigbox*}
\section{The relative impacts of GST on low-income households}
Many claim that the GST should not be increased because it would be unfair to low-income households.\footnote{For example, Labor Minister Tony Burke cited in \textcite{Hutchens2015}}
The Government should seek to protect the welfare of the bottom 20 per cent of taxpayers. Governments have an obligation to protect the welfare of those that are most vulnerable.\footnote{See \textcite[p.~21]{Daley2013} for further discussion.}

In \textbf{absolute amounts}, a GST collects far more from high-income households:\footcites{PublicFinance2014}{Freebairn2013}{Treasury2010}
the exemption for fresh food, for example, saves the richest 20 per cent of households around \$1000 per year, compared to an average of \$400 per year for the poorest 20 per cent of households.\footnote{Grattan estimates based on \textcites{Treasury2015b}{ABS2013a}{ABS2015b}} 

However, the fairness of a reform is often judged by looking at the percentage of a person's resources affected. 

Poorer households pay more GST as a proportion of their income because they have lower savings rates than richer households.\footnote{Savings rates increase strongly with disposable income quintile. The bottom quintile spends around 40 per cent than they earn (dissavings), while the top quintile saves around 20 per cent of their income.} But considered in the context of lifetime consumption opportunities, consumption taxes tend to be less inequitable. Many households that are low-incomeat a point in time -- students, retirees, short-term unemployed -- have much higher lifetime incomes. These people smooth their consumption by borrowing or drawing down on their savings when their income is low. Their consumption tax burden as a share of income will be high in these periods but much lower in others. The proportion of current consumption gives a better indication of the lifetime distributional effect of the tax.\footnote{\textcite{Treasury2010}; \textcite{PublicFinance2014} p.~34-36. If a household saves in net terms over their lifetime (\ie, they pass on some assets) then some of the tax burden will be deferred until the money is spend by the next generation. 
%Discussion of strange PC result (GST not regressive by income) and the reason -- based on private income not disposable income).
} 

As a percentage proportion of consumption, the GST has a similar effect on households across the income distribution.  Broadening the GST to include fresh food, and private spending on health and education would have a slightly larger effect on lower income households. Lower income households spend a little more on fresh food and health, which are currently exempt from GST. This outweighs their lower spending on education and childcare, the other major categories of expenditure currently exempt from GST, as shown in (\Vref{fig:Spending_on_exempt_goods_by_hh_quintile}).

\begin{figure}
<<Spending_on_exempt_goods_by_hh_quintile>>=
read_excel("Spending_on_exempt_goods_by_hh_quintile.xlsx") %>%
  setnames(1, "Category") %>%
  mutate(Category = factor(Category, levels = c("Food", "Education", "Medical", "Childcare"), 
                           labels =  c("Exempt food", "Education", "Medical", "Childcare"))) %>%
  select(-All) %>%
  gather(Quintile, prop_spending, -Category) %>%
  filter(complete.cases(.)) %>%
  group_by(Quintile) %>%
  mutate(label.text = Category,
         label.y = cumsum(prop_spending),
         bar.center = cumsum(prop_spending) - prop_spending/2) %>%
  ungroup %>%
  mutate(label.text = ifelse(Quintile == last(Quintile), as.character(Category), NA_character_)) %>%
  #
  grplot(aes(x = Quintile, y = prop_spending, fill = Category)) + 
  geom_bar(stat = "identity") + 
  geom_text(aes(x = 5.5, y = label.y, label = label.text, color = Category),
            hjust = 0, 
            fontface = "bold",
            size = 7.14,
            vjust = 1) + 
  geom_text(aes(x = Quintile, y = bar.center, label = scales::percent(round(prop_spending, 3))),
            size = 7.14) + 
  annotate("blank",
           x = 6.5, y = 0.01) +
  scale_y_continuous(label=percent,
                     expand = c(0,0),
                     limits = c(0,0.2)) + 
  theme(axis.title.x = element_text(hjust = 0.5),
        panel.grid = element_blank())
  
@
\Caption{Poorest households do not spend much more as a proportion of spending on exempt goods}{Proportion of spending, 2009-10}{fig:Spending_on_exempt_goods_by_hh_quintile}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/Spending_on_exempt_goods_by_hh_quintile-1}
\source{Housing Expenditure Survey}
\end{figure}
<<Broader_GST__Extra_expenditure>>=
current.gst.on.exempt.by.quintile <-
  read_excel("HH_GST_expenditure_by_quintile.xlsx", sheet = "GST_by_quintile")  %>%
  gather(gross_income_quintile, expenditure, Q1:Q5) %>%
  filter(!grepl("[12]$", Category)) %>% 
  mutate(gross_income_quintile = gsub("^Q", "", gross_income_quintile)) %>%
  ungroup %>%
  group_by(gross_income_quintile) %>%
  summarise(total_exempt_expenditure = sum(expenditure))

broad.extra.burden.per.1000 <- 
  hes10hh %>%
  group_by.income_quintile %>%
  summarise(total_expenditure = weighted.mean(Total_goods_and_services_expenditure_HES_only, Weight_HH_HES)) %>%
  setkey(gross_income_quintile) %>%
  merge(current.gst.on.exempt.by.quintile, by = "gross_income_quintile") %>%
  tbl_df %>%
  mutate(extra_gst = 0.1 * total_exempt_expenditure,
         extra.per.1000 = 1000 * extra_gst / total_expenditure)

Q1.extra.per.1000 <- 
  broad.extra.burden.per.1000 %>%
  filter(gross_income_quintile == 1) %$%
  round(extra.per.1000)
Q5.extra.per.1000 <- 
  broad.extra.burden.per.1000 %>%
  filter(gross_income_quintile == 5) %$%
  round(extra.per.1000)
@

Overall, the differences are small: poorer households would pay on average an extra \$\Sexpr{Q1.extra.per.1000}~per~\$1000 spent, compared with \$\Sexpr{Q5.extra.per.1000}~per~\$1000 for the top 20\%\ of households.

If the GST rate were raised but not broadened, poorer households would pay on average an extra \$25 per \$1000 spent, compared with the \$26 per \$1000 for high-income households. Although there is substantial variation in spending patterns between people in a given income group (\cref{sec:higherWelfarePayments}). 

Whether or not a tax is regressive because it takes a higher proportion of income from low-incomehouseholds, many are concerned by tax reforms that would take \emph{any} resources from the most vulnerable. Consequently, many proposals to increase GST envisage accompanying reforms to welfare that would offset the GST impacts on those worst off. While ethical theories differ on the value of minimising overall inequality, they generally converge on the importance of ensuring that those worse off have enough resources to pursue lives that they have reason to value.\footcite[See][p.~37]{Daley2013}

\section{Higher welfare payments can reduce the effects of a higher GST on poorer households}\label{sec:higherWelfarePayments}
However fairness is measured, governments  can mitigate the effects of GST changes on lower income households -- indeed governments can choose to overcompensate -- through the welfare system.

For the majority of households at the bottom 20 per cent of the income distribution -- those earning up to around \$36,000 a year  -- government payments are their main source of income. Forty per cent of the next poorest 20~per~cent of households receive most of their income from government. Unsurprisingly, those further up the income distribution generate most of their income through employment and investments, with very few reliant primarily on government benefits  (\Vref{fig:Sources_of_income_by_quintile}). 

\begin{figure}
<<Sources_of_income_by_quintile, fig.width=12, out.width="12in">>=
# Following to include in lieu of hardcoded original.  Note uses total income rather than disposable
hes10hh %>% 
  group_by.income_quintile(type = "Current_weekly_HH_disposable_income") %>%
  summarise(Employee.income = weighted.mean(Current_weekly_HH_employee_income, Weight_HH_HES),
            Gov.benefits = weighted.mean(Current_weekly_HH_income_from_government_pensions_and_allowances, Weight_HH_HES),
            Investment.income = weighted.mean(Current_weekly_HH_income_from_investments, Weight_HH_HES),
            Super.income = weighted.mean(Current_weekly_HH_income_from_superannuation_annuity_private_pension, Weight_HH_HES)
            ) %>%
  ungroup %>%
  gather(income_category, income_amt, -disposable_income_quintile) %>%
  mutate(income_category = factor(income_category, 
                                  levels = c("Employee.income", "Investment.income", "Super.income", "Gov.benefits"), 
                                  labels = c("Salary/wages", "Investments", "Super", "Welfare"))) %>%
  grplot(aes(x = disposable_income_quintile, y = income_amt, fill = income_category, order = income_category)) + 
  geom_bar(stat = "identity", position = "fill")

read_excel("Sources_of_income_by_quintile0910.xlsx") %>%
  setnames(1, "income_category") %>%
  mutate(income_category = factor(income_category, 
                                  levels = c("Employee.income", "Investment.income", "Super.income", "Gov.benefits"), 
                                  labels = c("Salary/wages", "Investments", "Super", "Welfare"))) %>%
  gather(Quintile, prop, -income_category) %>%
  arrange(Quintile, income_category) %>%
  filter(complete.cases(.)) %>%
  mutate(label.text = ifelse(Quintile == last(Quintile),
                             gsub("\\.", "\n", as.character(income_category)),
                             NA_character_
                             )) %>%
  group_by(Quintile) %>%
  mutate(prop2 = prop/sum(prop),
         label.y = cumsum(lag(prop2, default = 0)) + prop2/2
         ,vjust = ifelse(rank(label.y) == 4, -0.2, 0.5)
         ) %>%
  grplot(aes(x = Quintile, 
             y = prop,
             fill = income_category,
             order = income_category)) + 
  
  geom_bar(stat = "identity", position = "fill") + 
  geom_text(aes(label = label.text,
                x = 5.55,
                color = income_category,
                y = label.y,
                vjust = vjust),
            hjust = 0,
            lineheight = 0.70,
            fontface = "bold", 
            size = 8.01
  ) + 
  annotate("blank", x = 6.85, y = 1.10)  +
  scale_y_continuous(label=percent, expand = c(0,0), breaks = c(0,0.25, 0.50, 0.75, 1)) + 
  theme(panel.grid = element_blank())
  
@
\Caption{Poorest households receive most of their income from government benefits}{Proportion of income}{fig:Sources_of_income_by_quintile}
\makebox[\textwidth][l]{\includegraphics[width=1.1\columnwidth]{figure_BudgetRepair_GST/Sources_of_income_by_quintile-1}}
\end{figure}

<<percent_of_GST_burden_by_quintile>>=
GST.to.15.extra.gst.by.quintile <- 
  hes10hh %>% 
  group_by(Gross_income_quintile = factor(as.numeric(cut(Total_current_weekly_HH_income_from_all_sources, 
                                                         breaks = total.inc.quintiles,  
                                                         include.lowest = TRUE)))) %>%
  summarise(extra_gst = sum(Weekly_household_GST_on_all_goods_and_services_FIS * Weight_HH_HES) / 2) %>%
  ungroup %>%
  mutate(extra_gst.prop = extra_gst/sum(extra_gst)) %>%
  select(-extra_gst)


GST.broader.extra.gst.by.quintile <-
  read_excel("Proportion of HH expenditure on exempt categories - by quintile.xlsx",
             sheet = "Wkly_exp_by_gross_quintile") %>%
  setnames(old = "All households", "All_households") %>%
  select(-All_households) %>%
  gather(Gross_income_quintile, expenditure, -Exemption_category) %>%
  mutate(Gross_income_quintile = as.numeric(Gross_income_quintile)) %>%
  group_by(Gross_income_quintile) %>%
  summarise(extra_gst = sum(expenditure)) %>%
  ungroup %>%
  mutate(extra_gst.prop = extra_gst/sum(extra_gst))

quintile.burden <- function(type, quintile){
  stopifnot(type %in% c("broad", "to 15"))
  if (type == "broad"){
    return(GST.broader.extra.gst.by.quintile[GST.broader.extra.gst.by.quintile$Gross_income_quintile == quintile, ]$extra_gst.prop)
  }
  
  if (type == "to 15"){
    return(GST.to.15.extra.gst.by.quintile[GST.to.15.extra.gst.by.quintile$Gross_income_quintile == quintile, ]$extra_gst.prop)
  }
}
@

It follows that targeting compensation through the welfare system is the most direct way to compensate the poorest households. The poorest 20 per cent of households currently account for just over \Sexpr{latex_percent(quintile.burden("broad", 1))} of total spending on the goods and services we have proposed for including in a broader GST or \Sexpr{latex_percent(quintile.burden("to 15", 1))} per cent of the revenue from a higher GST.\footcite{ABS2013cx} If these households could be targeted directly, then spending \Sexpr{latex_percent(max(quintile.burden("broad", 1), quintile.burden("to 15", 1)))} of the revenues from the GST would be enough to ensure that they are no worse off on average after their higher expenses. Higher income households would bear most of the net burden of the tax increase.

However, compensation through higher welfare payments would not be perfectly targeted in reality. Only 30 per cent of welfare payments go to the bottom of 20 per cent of households (\Vref{fig:Welfare_by_household_disposable_income}). To ensure that the poorest households are no worse off as a group requires welfare benefits that will benefit some richer households as well, and thus spending much more than 10 per cent of the increased GST collection.
\begin{figure}
<<SIH201314>>=
sih201314hh <- # all vars
  read.dta("./SIH/Stata files/sih13bh.dta") %>%
  data.table

sih201314h <- 
  read.dta("./SIH/Stata files/sih13bh.dta") %>%
  data.table %>%
  select(
    Unique_household_number = ABSHID,
    Gross_household_income = INCTSCH8,
    Gross_imputed_rent = GROSSIR,
    Total_pensions_hh = ITGCBCH8,
    Weight_HH = SIHHHWT
  ) %>%
  mutate(Gross_household_income_less_imputed_rent = Gross_household_income - Gross_imputed_rent) %>%
  setkey(Unique_household_number)

gross_income_quintiles_1314 <- 
  sih201314h %>%
  svydesign(ids = ~Unique_household_number, data = ., weights = ~Weight_HH) %>%
  svyquantile(~Gross_household_income, design = ., quantiles = (0:5)/5)

gross_income_quintiles_1314_no_imputed_rent <- 
  sih201314h %>%
  mutate(Gross_household_income_less_imputed_rent = Gross_household_income - Gross_imputed_rent) %>%
  svydesign(ids = ~Unique_household_number, data = ., weights = ~Weight_HH) %>%
  svyquantile(~Gross_household_income_less_imputed_rent, design = ., quantiles = (0:5)/5)

sih201314p <-
  read.dta("./SIH/Stata files/sih13bp.dta") %>%
  data.table 
@

<<eval=FALSE>>=
sih201314hh %>%
  svydesign(data = ., weights = ~SIHHHWT, id = ~ABSHID) %>%
  svyquantile(~DISPSCH8, quantiles = c(0:5)/5, design = .) * 52 %>%
  grattan_dollar
@

<<Welfare_by_household_disposable_income>>=
welfare.by.income.quintile <- 
  sih201314p %>%
  select(
     Unique_household_number = ABSHID,
    Rent_assistance = CWKCRA  # Current_weekly_amount_
    ,Austudy = IAUSTCP #
    ,Age_Pension = IAGECP # 
    ,Disability = IDSUPPCP # 
    ,Carer_allowance = ICAREACP
    ,Carer_payment = ICAREPCP
    ,Carer_supplement = ICARESCP
    ,Family_tax_benefit = IFTBCP8 # 
    ,Baby_bonus = IMATCP # 
    ,Disability_DVA = IDISBCP # 
    ,Newstart = INEWLSCP #
    ,Other = IOTHPCP 
    ,Parenting = IPARENCP # 
    ,Parental_leave = IPPLCP # 
    ,Dad_and_partner_pay = IDPPLCP # 
    ,Partner_allowance = IPARTNCP # 
    ,Service_pension_DVA = ISERVCP # 
    ,Sickness_allowance = ISICKCP #
    ,Special_benefit = ISPECCP 
    ,War_widows_pension = IWARWCP
    ,widow_allowance = IWIDOWCP
    ,wife_pension = IWIFECP
    ,Youth_allowance = IYOUTHCP
    ,Utility_allowance = IUTILCP
    ,Senior_supplement = ISSUPCP
    ,Pension_supplement = IPSUPCP
    ,School_kids_bonus = ISCHPCP
    ,Clean_energy_suppl = ICEACP
    ,Total_pensions_and_allowances = ITGCBCP8
    #
    ,Weight_Person = SIHPSWT
  ) %>% 
  mutate(
    Pension = Age_Pension + Service_pension_DVA + Senior_supplement + Pension_supplement,
    Disability = Disability + Disability_DVA + Sickness_allowance + Carer_allowance + Carer_payment + Carer_supplement,
    Family = Family_tax_benefit + Baby_bonus + Parenting + Parental_leave + Dad_and_partner_pay + Partner_allowance + School_kids_bonus,
    Unemployment_study_youth = Newstart + Austudy + Youth_allowance,
    Other = Total_pensions_and_allowances - Pension - Disability - Family - Unemployment_study_youth  - Rent_assistance
  ) %>%
  setkey(Unique_household_number) %>%
  merge(sih201314h) %>% #group_by(Unique_household_number) %>% summarise(tot_dis = sum(Disability), Weight_HH = first(Weight_HH)) %$% weighted.mean(tot_dis, Weight_HH)  # verified at the aggregate they match 6523.0 2013-14
  group_by(Unique_household_number) %>%
  summarise(Pension = sum(Pension),
            Disability = sum(Disability),
            Family = sum(Family),
            Unemployment_study_youth = sum(Unemployment_study_youth),
            Other = sum(Other),
            Rent_assistance = sum(Rent_assistance),
            Weight_HH = first(Weight_HH), # technically should do a merge, but this works.
            Gross_household_income = first(Gross_household_income)
            ) %>% 
  ungroup %>%
  group_by(gross_income_quintile = .bincode(Gross_household_income, 
                                            breaks = gross_income_quintiles_1314, 
                                            include.lowest = TRUE)) %>%
  summarise(Pension = weighted.mean(Pension, Weight_HH),
            Disability = weighted.mean(Disability, Weight_HH),
            Family = weighted.mean(Family, Weight_HH),
            Unemployment_study_youth = weighted.mean(Unemployment_study_youth, Weight_HH),
            `Rental assistance` = weighted.mean(Rent_assistance, Weight_HH),
            Other = weighted.mean(Other, Weight_HH)) %>%
  gather(Payment_type, average_payment, Pension:Other)

welfare.by.income.quintile %>%
  group_by(gross_income_quintile) %>%
  mutate(text.y = cumsum(average_payment)) %>%
  grplot(aes(x = factor(gross_income_quintile), fill = Payment_type)) + 
  geom_bar(aes(y = average_payment), stat = "identity", position = "stack")  +
  geom_text(aes(label = gsub("_", "/",
                             ifelse(gross_income_quintile == 1, as.character(Payment_type), NA_character_),
                             fixed = TRUE),
                lineheight = 0.6,
                y = text.y), 
            vjust = 1, fontface = "bold", size = 6.14) + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  scale_y_continuous(label=grattan_dollar,
                     expand = c(0,0),
                     limits = c(0,400)) +
  theme(legend.position = c(0.8, 0.8)) + 
  annotate("blank", x = 00.2, y = 100) + 
  xlab("Gross income quintile")
  
  
@
\Caption{Higher welfare payments also benefit richer households}{Total spend in 2009-10}{fig:Welfare_by_household_disposable_income}
\makebox[\linewidth][r]{\includegraphics[width=1.0\columnwidth]{figure_BudgetRepair_GST/Welfare_by_household_disposable_income-1}}


\end{figure}

<<prop_welfare_by_income>>=
prop_welfare_by_income <- 
  welfare.by.income.quintile %>%
  group_by(gross_income_quintile) %>%
  summarise(total = sum(average_payment)) %>%
  ungroup %>% 
  mutate(prop = total/sum(total))

prop_welfare_by_income %>%
  grplot(aes(x = factor(gross_income_quintile),
             y = prop)) + 
  geom_bar(stat = "identity") + 
  scale_y_continuous(label=percent,
                     expand=list(c(0,0), c(0,0.1))) + 
  geom_text(aes(label = percent_format()(prop)),
            vjust = -0.25,
            size = 7.14)
@
\begin{figure}
\Caption{Welfare leaks}{Percentage of welfare by income quintile}{fig:prop_welfare_by_income}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/prop_welfare_by_income-1}
\source{HES}
\end{figure}

<<GST_increase_to_15pc>>=
if(!file.exists("GST_by_year.xlsx")){
  GST_url <- "http://data.gov.au/dataset/e29ef9ca-0d1a-47ec-9e9b-14a79a941511/resource/0e56ca39-832e-40ca-bc62-297a3fb552cf/download/taxstats2013gst1gstwetlctmultiyear.xlsx"
  GET(GST_url, write_disk("GST_by_year.xlsx"))
}
GST.by.year.actual <-
  read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
  setnames(1:2, c("Selected_item", "unit")) %>% 
  # en dash caution
  setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
  gather(year, value, `2001-02`:`2013-14`) %>%
  mutate(value = as.numeric(value)) %>%
  filter(complete.cases(.)) %>%
  filter(grepl("Net.GST", Selected_item))

EXTRA.WELFARE.SPENDING.PROPOSED <- 
  last(GST.by.year.actual$value) * 0.5 * 0.30 / # millions
  1e3 # bns
@
Spending around \$9 billion, or 30 per cent of revenues from increasing the GST rate to 15 per cent on higher welfare benefits would ensure that the poorest households are generally more than compensated for the higher costs. A policy of overcompensation can also be justified because of the risk that compensation may be eroded over time (\Vref{box:WelfareErosion}).

\begin{smallbox}{Will welfare benefits get eroded over time?}{box:WelfareErosion}
Previous experience in both Australia and New Zealand highlights the risk that compensation can be eroded over time if benefits do not keep pace with inflation. Increases in welfare benefits to compensate for the introduction of New Zealand's GST were cut sharply after a change of government.\autocite{Davidson2000}  In Australia, despite increases in Newstart following the introduction of the GST in 2000, the single adult Newstart rate has been eroded by cost of living increases so that it now buys less than it did before the GST was introduced.\autocite{ACOSS2012}

But recent budget proposals to index pensions at inflation rather than average weekly earnings met a hostile public reaction, and were abandoned in favour of tightening eligibility for those who need pensions least.\autocite{Morrison2015}  Indeed a series of decisions over the last decade to increase pensions above average weekly earnings  suggests that concerns about the longevity of compensation for pensioners may be exaggerated. 

On the other hand, concerns about the value of Newstart are based on recurring political decisions to reduce payments relative to average wages.  These concerns might be addressed if increases to the GST were accompanied by a substantial real increase in Newstart. Even if it were eroded over time, a large increase would leave most of those on Newstart substantially better off for some time. This might be the political price for welfare groups to support increases to the GST.
\end{smallbox}

Changes that over-compensated most households on Newstart would recognise the substantial financial distress of these households,  and the possibility that higher payments may increase workforce participation by improving the capacity of individuals to present themselves well or to maintain their readiness for work.  This reflects a broad consensus amongst welfare groups, economists and even business lobbies that Newstart payments are too low.  The rising gap in living standards between those on Newstart (and other allowances) and those receiving a pension is due to the less favourable indexation for Newstart.  

<<welfare.by.income.quintile.total>>=
gst_revenue.15pc.weekly <- 
  hes10hh %$%
  sum(Weekly_household_GST_on_all_goods_and_services_FIS * Weight_HH_HES)/2

ratio.gst_welfare <- percentage_of_revenue_to_transfers

welfare.by.income.quintile_total <-
  welfare.by.income.quintile %>%
  group_by(gross_income_quintile) %>%
  summarise(total = sum(average_payment)) %>%
  ungroup %>%
  mutate(prop_welfare = total/sum(total)) %>%
  select(-total)
@

<<amount_of_quintile_on_welfare>>=
amount_of_quintile_on_welfare <- 
  hes10hh %>%
  group_by.income_quintile() %>%
  group_by(has_welfare = Current_weekly_HH_income_from_government_pensions_and_allowances > 0, 
           gross_income_quintile) %>%
  summarise(n_on_welfare = sum(Weight_HH_HES)) %>%
  group_by(gross_income_quintile) %>%
  mutate(prop_on_welfare = n_on_welfare/sum(n_on_welfare)) %>%
  filter(has_welfare)
@

<<GST_compensation_by_quintile_and_threshold>>=
# welfare.by.income.quintile_total <- 
#   data.table(
#     gross_income_quintile = 1:5,
#     prop_welfare = c(1,rep(0,4))
#   )

hes_with_gst_compensation <- 
  hes10hh %>%
  group_by.income_quintile() %>%
  ungroup %>%
  data.table %>%
  setkey(gross_income_quintile) %>%
  merge(., welfare.by.income.quintile_total) %>%
  #merge(., amount_of_quintile_on_welfare) %>%  # for debugging?
  group_by(gross_income_quintile) %>%
  # Originally, we assumed that everyone in a quintile received the 
  # quintile's share of compensation...
  mutate(
    new_welfare2 = gst_revenue.15pc.weekly * percentage_of_revenue_to_transfers *
      prop_welfare / # amount to all households in that quintile
      sum(Weight_HH_HES)
  ) %>%
  group_by(gross_income_quintile,
           has_welfare = Current_weekly_HH_income_from_government_pensions_and_allowances > 0) %>%
  # Now we assume that only the set of people currently on welfare in a quintile receive
  # that quintile's share of welfare.  Each entry represents a single household, and the 
  # number of households in a quintile is determined by sum(Weight_HH_HES).  So to determine
  # an entry's share of compensation we allocate the amount of compensation in total, divide 
  # this among the quintiles, then within each quintile, divide by the number of households.
  mutate(
    new_welfare = 
      ifelse(has_welfare,
             gst_revenue.15pc.weekly * percentage_of_revenue_to_transfers *
               prop_welfare / # amount to all households in that quintile
               sum(Weight_HH_HES),
             0)
  ) 

welfare_compensation_adequacy <-
  hes_with_gst_compensation %>%
  group_by(gross_income_quintile) %>%
  summarise(comp_adequacy.75pc = weighted.mean(new_welfare > 0.75* Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES),
            comp_adequacy.100pc = weighted.mean(new_welfare > Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES),
            comp_adequacy.125pc = weighted.mean(new_welfare > 1.25*Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES)
  ) %T>%
  readr::write_csv(path = "./figure/GST_compensation_by_quintile_and_threshold.csv") %>%
  gather(threshold, comp_adequacy, comp_adequacy.75pc:comp_adequacy.125pc) %>%
  mutate(threshold = gsub("pc", "%", 
                          gsub("^.*\\.", "", threshold)),
         threshold = factor(threshold, levels = c("75%", "100%", "125%"), labels = c(">75%",
                                                                                     ">100%",
                                                                                     ">125%")))

welfare_compensation_adequacy %T>%
  chart_data() %>%
  mutate(`Gross income quintile` = gross_income_quintile) %>%
  grplot(aes(x = `Gross income quintile`, fill = threshold, y = comp_adequacy)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  #geom_text(aes(label = round(100*comp_adequacy))) + 
  scale_y_continuous("Percent reaching threshold", label=percent,
                     limits = c(0,1), 
                     expand = c(0,0)) + 
  guides(fill = guide_legend("Threshold of adeq.\ncompensation", label.theme = element_text(angle = 0, size = 23))) + 
#   theme(legend.position = c(0.7,0.7), 
#         legend.key.size = grid::unit(1.5, "lines")) + 
  annotate("text",
           x = 4,
           y = 0.5 + (3:1)/10,
           label = c("75% compensated", 
                     "100% compensated",
                     "125% compensated"),
           color = gpal(3),
           size = 9,
           hjust = 1,
           fontface = "bold")
@
\begin{figure}
\Caption{With 30\%\ of extra revenue to welfare transfers, most of the poorest households will be better off, some substantially so}{Proportion of each quintile compensated through increased welfare by the given amount relative to their excess burden due to a higher GST}{fig:GST_compensation_by_quintile_and_threshold}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/GST_compensation_by_quintile_and_threshold-1}
\end{figure}

And because low-income people have diverse patterns of spending, spending more that is required to compensate this group on average helps ensure that fewer people in this group go backwards as a result of the changes. Indeed, spending this much on across-the board increases in welfare payments would mean that 
nearly  % ceiling
\Sexpr{
paste0(ceiling(100 * dplyr::filter(welfare_compensation_adequacy, gross_income_quintile == 1, threshold == ">100%")$comp_adequacy), "\\%")
}% 
%70 per cent 
~of households in the bottom income quintile are better off, with 
nearly  % ceiling 
\Sexpr{
paste0(
round(ceiling(100 * dplyr::filter(welfare_compensation_adequacy, gross_income_quintile == 1, threshold == ">125%")$comp_adequacy)
, -1L),
"\\%")
}% 
~receiving back more than 125 per cent of their additional cost of living increases (\Vref{fig:GST_compensation_by_quintile_and_threshold}). 

Providing a greater share of compensation spending via those payments which lower income earners receive relatively more of -- unemployment and disability benefits and pensions (\Vref{fig:Sources_of_income_by_quintile}) --  would improve average compensation levels further.

But some poorer households will not be fully compensated. This is an unfortunate reality of any revenue positive tax reform. Increasing welfare payments to ensure that \emph{no-one} on low incomes is worse off (in terms of dollars in the pocket), would substantially increase the cost of the package.  

But of course, those on lower incomes -- just like others in the population -- also stand to receive substantial benefits from higher state government spending on healthcare from higher GST collections. Improvements in access to or quality of health services will improve living standards for all Australians.\footcite{Deloitte2015}  

\subsection{Structuring welfare payments to protect work incentives}
%
<<Newstart_entrants>>=
GST_by_year <-
  read_excel("GST_by_year.xlsx", sheet = "GST Table 1", skip = 2) %>%
  setnames(1:2, c("Selected_item", "unit")) %>% 
  # en dash caution
  setnames(old = names(.), new = gsub("([0-9]{4}).([0-9]{2})", "\\1-\\2", names(.))) %>%
  gather(year, value, `2001-02`:`2013-14`) %>%
  mutate(value = as.numeric(value)) %>%
  filter(complete.cases(.)) %>%
  filter(grepl("Net.GST", Selected_item)) %>%
  mutate(value = value * 1e6,
         unit = "$")  # dollar units

EXTRA.TRANSFER.AMT <- 
  GST_by_year[GST_by_year$year == "2012-13", ]$value * 0.5 *  # 15 percent
  0.3  # amount going to transfers

EXTANT.TRANSFERS.201213 <- 131.6 * 10^9  # budget papers

# New newstart / old newstart
NEWSTART.ALLOWANCE.RATIO <- 
  (EXTANT.TRANSFERS.201213 + EXTRA.TRANSFER.AMT) / EXTANT.TRANSFERS.201213

# Assume newstart will increase by this ratio.
allowance <- 
  12807.60  # http://www.cpaaustralia.com.au/~/media/corporate/allfiles/document/professional-resources/financial-planning/tax-social-security-guide-2012-13.pdf

allowance_with_income <- 
  function(fortnightly.income){
    fortnightly.income + max(0, 492.6 - (0.5 * (fortnightly.income - 62) * IND(fortnightly.income, min = 62, max = 250) +
                                           IND(fortnightly.income, min = 250) * 0.6 * (fortnightly.income - 250)))
  }

# Determine the allowance cutoff. (Not best practice but readable.)
for (i in 492:2000){
  if (allowance_with_income(i) == i){
    allowance_cutoff_fortnightly <- i
    break
  }
}

ALLOWANCE.CUTOFF <- 
  allowance_cutoff_fortnightly * 26

tax201213 <- get_sample_file()

# This underestimates extants...
## How many individuals of a certian income are on newstart
# ====
NEWSTART.ENTRANTS <- 
  tax201213 %$%
  sum(Taxable_Income >= ALLOWANCE.CUTOFF & 
        Taxable_Income <= ALLOWANCE.CUTOFF * NEWSTART.ALLOWANCE.RATIO) * 52* 0.05
@
%
Compensation can be structured so as not to reduce disincentives for work. If welfare payments are increased by a fixed amount, there will be no change in effective tax rates for current welfare participants (\Vref{box:ReduceWelfareDisincentives}). This will happen to some degree via current indexation of benefits -- increases in the general price level flow through to the base rate of payments. But if the intention is to overcompensate, additional top-ups to the base rate will likely also need to be legislated. 

The main impact on work incentives will be for those people brought into the net for welfare benefits. These people will face higher effective marginal tax rates as any additional income they earn will see a withdrawal of some welfare benefits. However, our estimates suggest this group is relatively small -- it might add an  additional \Sexpr{texNum(NEWSTART.ENTRANTS,1)}Newstart recipients to the 680,000 who currently receive this payment (\Vref{box:ReduceWelfareDisincentives}).%
\footnote{Grattan analysis. We assume that the increased welfare (approximately 5\%) flows uniformly to every payment category. Newstart entrants are those without welfare payments whose taxable income is between 100\%\ and  105\%\ of the current Newstart cutoff.}

\begin{bigbox*}{Structuring welfare payments to reduce disincentives for work}{box:ReduceWelfareDisincentives}
Means tested welfare payments reduce work incentives. If welfare recipients start earning income, they not only pay tax on each dollar of income earned but also face some withdrawal of their benefits. The impact on work incentives is moderated by a ``taper'' which reduces benefits gradually as incomes increase.

Maintaining the same ``taper'' will ensure that higher welfare payments do not directly reduce incentives to work (the ``substitution effect''). Increasing welfare by a fixed dollar amount for all recipients (whether they are receiving a full or part benefit) maintains the taper. For almost all levels of income, the dollar value of payments withdrawn with each additional dollar earned is the same under the new compensation arrangements (Figure 8). 

In contrast, a proportional increase in benefits would make the taper rate steeper, increasing effective tax rates for those in the relevant income range. But even with a fixed dollar increase in benefits, there will be some effects on incentives to work.  

First, because higher welfare payments will increase real income for some recipients, this could reduce the attractiveness of working more (the ``income effect''). However, it is not clear this effect will be substantial given the relatively modest increases in overall income associated with the proposed increase in payments. 

Second, some people will face higher EMTRs because they are brought into the welfare net.

Specifically, people on incomes somewhat above the previous cut off point will now receive a (modest) welfare benefit (\Vref{fig:Sources_of_income_by_quintile}). This increases their effective tax rate because they will face withdrawal of this benefit as their income increases. However, the number of people affected is modest -- we estimate than an extra \Sexpr{texNum(NEWSTART.ENTRANTS,1)}people might qualify for some Newstart payment, very small in the context of the 680,000 or so that already receive that payment. 

\end{bigbox*}

\section{Income tax cuts can compensate the average lower income household}
Modest income tax cuts should be part of any GST reform package. 

Appropriately targeted income tax cuts will help to moderate the effect of a higher GST on work incentives. By increases prices of many good and services, a higher or broader GST, reduces the real purchasing power of take home pay. But tax cuts mean the size of workers' pay packets is larger. But income tax cuts mean that workers will have bigger pay packets. 

This partial ``swap'' of income taxes for consumption taxes will provide an economic dividend. However, the economic gain will depend on the design of any income tax cuts: cuts targeted at middle income earners are likely to have a much bigger impact on participation than reductions in the top marginal rate only paid by a small number of taxpayers who usually work full time (\vref{chap:Chapter1}).

But if the purpose of GST reform is to help state governments fund rising healthcare costs, there is a limit to the money available to fund income tax reductions. Given our proposed welfare package, spending any more than 30 per cent of the revenue on tax cuts will not leave state governments with enough funds to make a meaningful dent in their health funding ``gap'', or deficit reduction. 

We propose a package of income tax cuts that helps protect welfare of lower and middle income households. Spending 30 per cent of additional GST revenues allows for modest income tax cuts in the low to middle brackets. 

For example, using \$8 billion of the additional \$27 billion of revenue from a 15 per cent GST would allow a reduction in the bottom tax bracket from 19 per cent to 16.5 per cent and a reduction in the next bracket from 32.5 to 30.5 per cent. If, instead the GST is broadened, 30 per cent of the revenue from a broader GST would supports cuts to approximately 18 per cent and 31 per cent for the same brackets. To put these tax cuts into context, they have a similar impact on average tax rates as 4 years of bracket creep.\footnote{Grattan Insitute calculations. For impact of bracket creep, see \textcite[p.~6]{daleywood2015fiscalchallenges}.}  Households higher up the income scale would receive substantial benefit from these tax changes. 

\Vref{fig:GST_compensation_and_tax_cuts_by_quintile_and_threshold} shows the combined effect of a higher GST but lower income tax rates and higher welfare payments proposed under our package. 
\subsection{The size of income tax cuts}
We propose a package of income tax cuts that helps protect welfare of lower and middle income households. Spending 30 per cent of additional GST revenues allows for modest income tax cuts in the low to middle brackets. 

For example, using \$9~billion of the additional revenue from a 15 per cent GST would allow a reduction in the bottom tax bracket from 19 per cent to 16.5 per cent and a reduction in the next bracket from 32.5 to 30 per cent.\footnote{\url{https://grattan.shinyapps.io/Changing_income_taxes/Forty_three_app.Rmd}}

While 30 per cent of the revenue from a broader GST would support cuts to around 18 per cent and 30.5 per cent for those same brackets. 

After tax cuts, households higher up the income scale receive some compensation for the increase in their cost of living. \Vref{fig:GST_compensation_with_tax_cuts} shows levels of compensation for a higher GST after the tax cuts and welfare payments proposed under an increase of the GST under the current base to 15\%. 

The bottom 40 per cent of households -- those with incomes up to \$63,000 annually\footnote{This was the maximum income placing the household in the bottom 40 per cent of household incomes in 2013/14. ABS Survey of Income and Housing}  -- on average would come out in front. Higher up the income distribution, households on average would come out behind, although most households in the third and fourth quintiles would not go backwards by much: for them lower income taxes would offset three quarters or more of the effects of a higher GST.



\begin{figure}
<<Corroborate_size_of_tax_cuts, error=FALSE>>=
tax200910 <- get_sample_file(2010)
INCOME.TAX.COLLECTED.200910 <- sum(income_tax(tax200910$Taxable_Income, "2009-10")) * 100
GST.COLLECTED.200910 <- 44e9 # http://www.treasury.gov.au/Policy-Topics/Taxation/Pocket-Guide-to-the-Australian-Tax-System/Pocket-Guide-to-the-Australian-Tax-System/Appendix-C
revenue_avbl_for_tax_cuts <- 
  percentage_of_revenue_to_tax_cuts * GST.COLLECTED.200910 / 2  # for 15%
size_of_tax_cut <- 
  INCOME.TAX.COLLECTED.200910 - sum(new_income_tax_outer0910(tax200910$Taxable_Income, rates = new_0910_tax_rates))*100

if(abs(size_of_tax_cut - revenue_avbl_for_tax_cuts) > 0.5e9){

  stop("Tax cut differs by more than $0.5 bn (", texNum(size_of_tax_cut - revenue_avbl_for_tax_cuts), ")")
}
@

<<GST_compensation_with_tax_cuts>>=
hes10_indiv %<>%
  mutate(taxable_income = ifelse(Imputed_current_weekly_tax_payable < 0, 
                                 0, 
                                 inverse_income(52 * pmax(0, Imputed_current_weekly_tax_payable), 
                                                fy.year = "2009-10", 
                                                zero.tax.income = "uniform")))

hes10_indiv %<>%
  mutate(
    old_tax = 52 * Imputed_current_weekly_tax_payable,
    new_tax = ifelse(old_tax < 0, old_tax, new_income_tax_outer0910(taxable_income, rates = new_0910_tax_rates)),
    tax_diff = old_tax - new_tax
      ) 

new_tax_by_indiv <- 
  hes10_indiv %>%
  select(Unique_household_number, 
         tax_diff) %>%
  group_by(Unique_household_number) %>%
  summarise(tax_diff = sum(tax_diff))

hes_with_gst_and_tax_compensation <- 
  hes_with_gst_compensation %>%
  merge(new_tax_by_indiv, by = "Unique_household_number") %>%
  mutate(tax_diff_weekly = tax_diff / 52) 

welfare_and_tax_compensation_adequacy <- 
  hes_with_gst_and_tax_compensation %>% 
  group_by(gross_income_quintile) %>%
  summarise(comp_adequacy.75pc = weighted.mean(new_welfare + tax_diff_weekly > 0.75* Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES),
            comp_adequacy.100pc = weighted.mean(new_welfare + tax_diff_weekly > Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES),
            comp_adequacy.125pc = weighted.mean(new_welfare + tax_diff_weekly > 1.25*Weekly_household_GST_on_all_goods_and_services_FIS/2, Weight_HH_HES)
  )

welfare_and_tax_compensation_adequacy %T>%
  readr::write_csv("./figure/GST_compensation_and_tax_cuts_by_quintile_and_threshold.csv") %>%
  gather(threshold, comp_adequacy, comp_adequacy.75pc:comp_adequacy.125pc) %>%
  mutate(threshold = gsub("pc", "%", 
                        gsub("^.*\\.", "", threshold)),
         threshold = factor(threshold, levels = c("75%", "100%", "125%")),
         `Gross income quintile` = gross_income_quintile) %>%
  grplot(aes(x = `Gross income quintile`, fill = threshold, y = comp_adequacy)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  scale_y_continuous("Percent reaching threshold", 
                     label=percent,
                     breaks = (0:10)/10,
                     expand = c(0,0),
                     limits = c(0,1)) + 
  geom_hline(yintercept = 0.50, linetype = 2) + 
  guides(fill = guide_legend("Comp/burden",
                             direction = "horizontal",
                             label.position = "bottom",
                             title.position = "top",
                             title.hjust = 0.5,
                             label.hjust = 0.5,
                             keywidth = 3,
                             override.aes = list(linetype = 0)
                             )) + 
  theme(legend.position = c(0.7,0.8),
        axis.title.y = element_text(angle = 90),
        legend.key.width = unit(2.5, "lines"))
@
\Caption{Tax cuts ease the burden for the third and fourth quintiles}%
{Percentage of each quintile compensated for a 15\%\ GST to the given degree after higher welfare payments and tax cuts}%
{fig:GST_compensation_with_tax_cuts}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/GST_compensation_with_tax_cuts-1}
\end{figure}

<<Are_bottom_40pc_compensated>>=
welfare_and_tax_compensation_adequacy %>% 
  filter(gross_income_quintile %in% 1:2) %$% 
  all(comp_adequacy.100pc > 0.5) ->
  bottom40pc.overcompensated.on.avg
@

<<Third_and_fourth_quintile_compensation_adequacy>>=
welfare_and_tax_compensation_adequacy %>% 
  filter(gross_income_quintile %in% 3:4) %$%
  all(comp_adequacy.75pc > 0.5) ->
  middle40pc.compensated.by.75pc
@

The bottom 40~per~cent of households are
\Sexpr{
if (bottom40pc.overcompensated.on.avg) "overcompensated" else "not overcompensated"
}%
~on average for the increase in the GST. Higher up the income distribution, compensation is less generous on average. 
\Sexpr{
if (middle40pc.compensated.by.75pc)
"Still, more than half of those in the third and fourth quintiles are compensated for the vast majority (75 per cent or more) of the increase in their cost of living under a higher GST."
}

<<Comp_required_to_cover_90pc_of_third_quintile>>=
third.quintile <- 
  hes10hh %>%
  group_by.income_quintile %>%
  ungroup %>%
  filter(gross_income_quintile == 3)

third.quintile %>%
  svydesign(ids = ~Unique_household_number, data = ., weights = ~Weight_HH_HES) %>%
  svyquantile(~Weekly_household_GST_on_all_goods_and_services_FIS, quantiles = (0:10)/10, design = .) ->
  GST.deciles.third.quintile

cpi_inflator(GST.deciles.third.quintile[9] * 52, from_fy = "2009-10", to_fy = "2012-13") -> GST_compensation_required
cpi_inflator(GST.deciles.third.quintile[9] * 52, from_fy = "2009-10", to_fy = "2013-14") -> GST_compensation_required_1314

# By inspection of https://grattan.shinyapps.io/Changing_income_taxes/Forty_three_app.Rmd
# Cuts to 14% and 24.5% leave $100,000 individual $4380 better off.
# GST_compensation_required
# # [1] 4370.295


@

\newcommand{\tblHead}[2][c]{\bfseries\begin{tabular}[#1]{@{}l@{}}#2\end{tabular}}
\newcommand{\tblHeadR}[2][c]{\bfseries\begin{tabular}[#1]{@{}>{\raggedleft}p{\linewidth}@{}}#2\end{tabular}}
\begin{table}
\caption{Budgetary impact of income tax rate changes}\label{tbl:tax_cuts}
\begin{tabularx}{\columnwidth}{lr>{\raggedleft\arraybackslash}X}
\toprule
\tblHead{Tax bracket} & \tblHead{Current tax rate} & \tblHeadR{Budgetary impact of 1 percentage point change (2015-16)}\\
\midrule
\$0-\$18,200 & 0\% & \\
\$18,201 - \$37,000 & 19\% & \$1.9\\
\$37,001 - \$80,000 & 32.5\% & \$2.3\\
\$80,001 - \$180,000& 37\% & \$1.3\\
\$180,001 + & 45\% & \$0.7\\
\bottomrule
\end{tabularx}

\notes{Excludes Temporary Budget Repair Levy (2\%\ for those earning over \$180,000 until 2016-17)}

\source{Grattan analysis ATO 2\%\ sample file (2013). See \url{https://grattan.shinyapps.io/Changing_income_taxes/Forty_three_app.Rmd}}
\end{table}

\newcolumntype{Y}{>{\raggedleft\arraybackslash}X}
% \newcommand*{\thead}[1]{%
% \multicolumn{1}{r}{\bfseries\begin{tabular}{@{}c@{}}#1\end{tabular}}%
% }
\begin{table*}[!htbp]
\caption{Impact of GST compensation package on selected households}\label{tbl:GST_comp_selected_hh}
\begin{center}
<<GST_by_welfare_type, results = 'asis'>>=
hes_with_gst_and_tax_compensation_indiv <-
  hes_with_gst_and_tax_compensation %>%
  merge(hes10_indiv, by = "Unique_household_number", suffixes = c("hh", "indiv")) 

hes_with_gst_and_tax_compensation_indiv %>%
  group_by(Unique_household_number) %>%
  mutate(Household_type = ifelse(sum(Current_weekly_income_from_age_pension) > 0 & 
                                   # on the full age pension for a couple (approximately)
                                   between(sum(Current_weekly_income_from_age_pension), 230, 245) & 
                                   # is a couple
                                   grepl("Couple", Family_type) & 
                                   # Own their own home
                                   Year_purchased_dwelling_HH_ranged != "Not applicable",
                                 "Age pension; no other income, couple, home-owners",
                                 ifelse(sum(Current_weekly_income_from_newstart_allowance) > 0 &
                                          # Jim QC
                                          between(sum(Current_weekly_income_from_newstart_allowance), 227, 251) &
                                          # Is single
                                          !grepl("Couple", Family_type) &
                                          # Is renting
                                          Weekly_rent_payments_HH > 0,
                                        "Newstart; Single, no other income, renter",
                                        ifelse(sum(Current_weekly_income_from_newstart_allowance) > 0 &
                                                 grepl("Couple", Family_type) & 
                                                 # 2 children under 15
                                                 grepl("^2", Number_of_dependent_children_aged_under_years_in_household) & 
                                                 # Other salary
                                                 sum(Current_weekly_HH_employee_income) > 0 &
                                                 # is renting
                                                 Weekly_rent_payments_HH > 0,
                                               "Newstart; Couple, 2 children, on salary income, renting",
                                               ifelse(sum(Current_weekly_income_from_disability_support_pension) > 0 &
                                                        !grepl("Couple", Family_type) &
                                                        sum(Current_weekly_HH_employee_income) < 1 & 
                                                        Weekly_rent_payments_HH > 0,
                                                      "Disability; Single, no other income, renter",
                                                      #
                                                      #
                                                      "Other")
                                        )
                                 )
  )) %>%
  filter(Current_weekly_HH_disposable_income > 0
         #,grepl("Age pension", Household_type)) %>% select(Current_weekly_HH_disposable_income, Weekly_household_GST_on_all_goods_and_services_FIS, new_welfare, tax_diff_weekly) %>% as.data.table %>% print
) %>%
  group_by(Household_type) %>%
  summarise(new_benefit = weighted.mean(new_welfare + tax_diff_weekly, Weight_HH_HES),
            GST_burden = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS / 2, Weight_HH_HES),
            prop_increase_in_disp_inc = weighted.mean((new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2 +  Current_weekly_HH_disposable_income)/(Current_weekly_HH_disposable_income), Weight_HH_HES) - 1,
            avg_disp_inc_before = weighted.mean(Current_weekly_HH_disposable_income, Weight_HH_HES),
            avg_disp_inc_after = weighted.mean((new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2 +  Current_weekly_HH_disposable_income), Weight_HH_HES),
            `zcomp.over.burden` = weighted.mean((new_welfare + tax_diff_weekly) / (Weekly_household_GST_on_all_goods_and_services_FIS / 2),
                                           Weight_HH_HES),
            prop_undercomp = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
                                           Weight_HH_HES)) %>%
  # cosmetic changes:
  mutate(
    `Household type` = Household_type,
    `New benefit` = paste0("\\", grattan_dollar(new_benefit)),
    `GST burden` = paste0("\\", grattan_dollar(GST_burden)),
    `$\\Delta$dispos income` =  latex_percent(prop_increase_in_disp_inc),
    `Comp / Burden` = latex_percent(`zcomp.over.burden`),
    `prop undercomp` = latex_percent(prop_undercomp)
  ) %>%
  select(-contains("_"), -starts_with("zc")) %>%
  xtable(
    #align = "lp{0.3\\columnwidth}rrrrr"
    align = "lp{5cm}YYYYY"
  ) %>%
  print(tabular.environment = "tabularx", 
        width = "1.4\\columnwidth", 
        include.rownames = FALSE,
        #floating.environment = "table*",
        floating = FALSE,
        table.placement = "tp",
        booktabs = TRUE,
        sanitize.text.function = function(x)x,
        #sanitize.colnames.function = function(name){ifelse(grepl("Household", name), name, paste0("\\thead{", name, "}"))} 
        sanitize.colnames.function = function(x)x
        ) 
@
\end{center}
%\vspace*{5.5pt}
\notes{This analysis is based on welfare benefits and spending pattersn from 2009-10 because this is the most recent for which spending data at the household level is available.}

\source{\gao\ \textcite{HES200910}}
\end{table*}

<<Impact_on_dispoable_income_undercompensated>>=
hes_with_gst_and_tax_compensation %>%
  mutate(is_undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS/2 > new_welfare + tax_diff_weekly) %>%
  filter(gross_income_quintile == 1, is_undercompensated) %>%
#   mutate(change_in_disposable_income = (Current_weekly_HH_disposable_income + new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2) / Current_weekly_HH_disposable_income) %$%
#   weighted.mean(change_in_disposable_income, Weight_HH_HES) ## NaN
  summarise(change_in_disposable_income = sum(Current_weekly_HH_disposable_income + new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2) / sum(Current_weekly_HH_disposable_income)) %$%
  change_in_disposable_income ->
  change_in_disposable_income

red.in.disp.inc.Q1 <- # reduction in disposable income for bottom quintile
  latex_percent(1 - change_in_disposable_income)
@

For the minority group of poorer households that go backwards, the change in their living standards is very small. The average reduction is disposable income is \Sexpr{red.in.disp.inc.Q1}. The fact that some people will be slightly worse off will make reform politically harder, but there is no principled reason to preserve the precise rank order of those in the bottom 20 per cent that applies today.

<<Impact_on_dispoable_income_third_fourth_quintile>>=
hes_with_gst_and_tax_compensation %>%
  mutate(is_undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS/2 > new_welfare + tax_diff_weekly) %>%
  filter(gross_income_quintile %in% 3:4) %>%
#   mutate(change_in_disposable_income = (Current_weekly_HH_disposable_income + new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2) / Current_weekly_HH_disposable_income) %$%
#   weighted.mean(change_in_disposable_income, Weight_HH_HES) ## NaN
  summarise(change_in_disposable_income = sum(Current_weekly_HH_disposable_income + new_welfare + tax_diff_weekly - Weekly_household_GST_on_all_goods_and_services_FIS/2) / sum(Current_weekly_HH_disposable_income)) %$%
  change_in_disposable_income ->
  change_in_disposable_income_third_fourth_quintiles

@

Politicians might be tempted to try to fully compensate all low and middle income households. 
But because GST affects different households in very different ways, it is extremely expensive to ensure there are \emph{no} losers.  
Tax cuts to at least fully compensate almost every household earning up to \$100,000 for a 5 per cent increase in the GST would have cost the 2012-13 budget approximately \$23.6 billion -- and this would be an underestimate of the budgetary impact today.  This is in addition to the \$9 billion in additional welfare payments required to compensate the most vulnerable (section 3.2). Together, the \$29 billion spend on compensation would exceed the additional \$27 billion in revenue collected. It is simply not possible to fully compensate this far up the income distribution and retain a revenue positive package.


\subsection{--- Remarks about nonnegative incomes ---}
<<prop_hh_nonpositive_income>>=
hes10hh %$%
  weighted.mean(Total_current_weekly_HH_income_from_all_sources <= 0, Weight_HH_HES) ->
  prop_hh_nonpositive_income
@

<<prop_hh_leq_Newstart>>=
# http://www.humanservices.gov.au/spw/corporate/publications-and-resources/resources/co029/archive/co029-0901.pdf
# 449.30 per fortnight
NEWSTART.ALLOWANCE.200910.FORTNIGHTLY = 449.30

hes10hh %$% 
  weighted.mean(Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2, Weight_HH_HES) ->
  prop_hh_leq_Newstart
@

<<prop_undercompensated_w_inc_leq_Newstart>>=
hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
  filter(undercompensated, gross_income_quintile == 1) %$%
  weighted.mean(leq_Newstart, Weight_HH_HES)
@

<<nonpositive_incomes_spending_patterns>>=
hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
  filter(gross_income_quintile == 1) %>%
  grplot(aes(x = Total_current_weekly_HH_income_from_all_sources, y = Weekly_household_GST_on_all_goods_and_services_FIS,
             color = leq_Newstart)) + 
  geom_point(aes(alpha = Weight_HH_HES)) + 
  theme(legend.position = c(0.2, 0.8))

hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
#   mutate(Category = ifelse(leq_Newstart, TRUE, ifelse(gross_income_quintile == 1, FALSE, NA))) %>%
#   t.test(Weekly_household_GST_on_all_goods_and_services_FIS ~ Category, data = .)
  grplot(aes(x = factor(gross_income_quintile), fill = leq_Newstart, y = Weekly_household_GST_on_all_goods_and_services_FIS, weights = Weight_HH_HES)) + 
  geom_boxplot() + 
  scale_y_continuous("Weekly GST", label = grattan_dollar)
@

<<GST_compensation_with_dubious_nonpositive_income_annotation>>=
# here we identify all all those household with nonpostive income who are "undercompensated" by our model.
hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
  #
  group_by.income_quintile() %>%
  summarise(compensated = weighted.mean(!undercompensated, Weight_HH_HES),
            #leq_Newstart = weighted.mean(leq_Newstart & !undercompensated & new_welfare > 0, Weight_HH_HES),
            not_compensated_but_below_Newstart = weighted.mean(undercompensated & leq_Newstart & new_welfare == 0, Weight_HH_HES)) %>%
  gather(group, prop, -gross_income_quintile) %>%
  grplot(aes(x = factor(gross_income_quintile),
             y = prop,
             fill = group)) + 
  geom_bar(stat = "identity") + 
  scale_y_continuous(label = percent,
                     expand = c(0,0),
                     limits = c(0,1),
                     breaks = (0:10)/10) + 
  theme(legend.position = c(0.8,0.8))
@

<<HH_w_inc_leq_Newstart_enter_newstart>>=
HH_w_inc_leq_Newstart_enter_newstart <- 
  hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
  group_by.income_quintile() %>%
  mutate(new_welfare3 = ifelse(leq_Newstart | new_welfare > 0, max(new_welfare), 0)) %>%
  group_by.income_quintile() %>%
  summarise(comp_adequacy = weighted.mean(new_welfare + tax_diff_weekly > Weekly_household_GST_on_all_goods_and_services_FIS/2, 
                                          Weight_HH_HES),
            comp_adequacy3 = weighted.mean(new_welfare3 + tax_diff_weekly > Weekly_household_GST_on_all_goods_and_services_FIS/2, 
                                          Weight_HH_HES)) %>%
  ungroup %>%
  mutate(extra_adequacy = comp_adequacy3 - comp_adequacy) %>%
  filter(gross_income_quintile == 1) 

comp_adequacy.orig <- 
  HH_w_inc_leq_Newstart_enter_newstart$comp_adequacy[1]

comp_adequacy.newstart_allow <- 
  HH_w_inc_leq_Newstart_enter_newstart$comp_adequacy3[1]
@

<<>>=
hes_with_gst_and_tax_compensation %>%
  as.data.table %>%
  group_by.income_quintile() %>% ungroup %>%
  mutate(undercompensated = Weekly_household_GST_on_all_goods_and_services_FIS / 2 > new_welfare + tax_diff_weekly,
         leq_Newstart = Total_current_weekly_HH_income_from_all_sources < NEWSTART.ALLOWANCE.200910.FORTNIGHTLY/2) %>%
  group_by.income_quintile() %>%
  mutate(new_income_quintile = as.integer(ifelse(leq_Newstart, 2, gross_income_quintile))) %>%
  group_by(new_income_quintile) %>%
  mutate(new_welfare3 = ifelse(leq_Newstart | new_welfare > 0, max(new_welfare), 0)) %>%
  group_by(new_income_quintile) %>%
  summarise(comp_adequacy = weighted.mean(new_welfare + tax_diff_weekly > Weekly_household_GST_on_all_goods_and_services_FIS/2, 
                                          Weight_HH_HES),
            comp_adequacy3 = weighted.mean(new_welfare3 + tax_diff_weekly > Weekly_household_GST_on_all_goods_and_services_FIS/2, 
                                          Weight_HH_HES)) %>%
  ungroup %>%
  mutate(extra_adequacy = comp_adequacy3 - comp_adequacy)
@

This analysis overestimates how many people in the bottom quintile would be worse off. The ABS survey used for calculating the impacts of taxes appears to have a substantial number of households that mis-state their income. About \Sexpr{latex_percent(prop_hh_nonpositive_income)} of all households (by definition in the bottom quintile) are recorded in the ABS survey as having zero or negative income, and another \Sexpr{latex_percent(prop_hh_leq_Newstart - prop_hh_nonpositive_income)} have incomes less than Newstart for a single person of \$\Sexpr{scales::comma_format(digits = 2)(round(NEWSTART.ALLOWANCE.200910.FORTNIGHTLY * 26, 2))}~per year (2009-10). If households with incomes below the minimum of the least generous welfare benefit are assumed to enter the welfare system then \Sexpr{latex_percent(comp_adequacy.newstart_allow)}~per cent of the lowest income quintile would be fully compensated by our proposed package, rather than \Sexpr{latex_percent(comp_adequacy.orig)}~per cent as shown in Figure~7.




\chapter{The uses of GST revenue}
If the GST is broadened or raised, governments will have additional revenue of between \$7 to \$11 billion a year after paying for the compensation package we have proposed of welfare increases and tax reductions to lower and middle income earners. This additional revenue might:
\begin{itemize}
\item reduce the hospital funding ``gap'' of state governments;
\item reduce the Commonwealth's substantial deficit;
\item fund other tax cuts, over and above the income tax cuts focussed on the lower thresholds proposed as part of the compensation package.
\end{itemize}

The federal politics are likely to require that at least some of the GST revenue improves the net budget position of the States and Territories. Even then, it will be difficult to fashion a deal that will be acceptable to both Commonwealth and States. States are unlikely to be enthusiastic about surrendering the principle that all of the GST revenue is transferred to them. And as the Commonwealth will need to fund the compensation package, it will only be able to afford to transfer all of the GST revenue to the States if it also reduces tied grants, which is unlikely to be politically attractive.

\section{GST increases could reduce the funding gap for hospitals}
State and Territory governments are likely to view a net increase in funding of \$5 billion a year as the minimum price for their cooperation in substantial changes to the GST. This would consume a substantial portion of the additional revenue raised by changes to the GST, net of the compensation package.

Government health spending in Australia -- and in developed countries around the world -- has consistently grown much faster than the economy over the last 20 years.\footcites[p.~25-27]{Daley2014}[p.~17]{Daley2014}  Under the COAG National Health Reform Agreement, the Commonwealth agreed to share the costs of growth in hospital activity (with an efficiency requirement) initially meeting 45 per cent of the cost growth, planned to rise to 50 per cent in 2017. In effect the Commonwealth committed to contributing to real increases in spending per person.

However, under changes announced in the May 2014 budget, the Commonwealth announced that its support for State health spending would only grow in line with inflation and population, and would not keep pace with economic growth, let alone the expected growth in health spending above this level. State governments would have to fund all increases in real spending per person for hospitals.\footcite[BP~No.2, p.~126]{Budget2014}

This decision will have a large and growing impact on State government budgets. The Commonwealth estimates that by 2024-25 the changed policy will reduce its real spending on hospitals by \$11 billion.\footnote{Health estimates based on \textcite{Hockey2015}. (See: \textcite[p.~16-18]{Daley2015}.}
By 2054-55, the reduction in real spending for hospitals could be as large as \$78 billion.\footcite[p.~7]{Treasury2014a}
Similar policy decisions in schools funding will reduce Commonwealth spending on schools by \$5 billion by 2024-25.\footnote{Estimates in 2014-15 dollars. Estimate calculated from nominal value of transfer provided in \textcite{Treasury2014a}.} 

States are unlikely to cooperate with changes to the GST unless they receive more money from the proceeds than they have effectively lost from the Commonwealth's recent reduction in health funding. The GST legislation requires the consent of all States and Territories for amendments.  Although the GST legislation technically requires the consent of all States and Territories for amendments,\footnote{Section 11 of \textit{A New Tax System (Managing the GST Rate and Base) Act~1999} (Cth)}  the Commonwealth Parliament can avoid this requirement, by simply repealing the section requiring State and Territory consent.\footcite{twomey2003federal}  Nonetheless, it would be politically unwise for the Commonwealth to pursue reforms without substantial State government support. Without some net contribution to their budgets, it is difficult to see why State governments would cooperate with the Commonwealth to increase the GST, with all the political costs such support would entail. 

\section{GST increases could reduce the Commonwealth's substantial deficit}
Alternatively, the additional GST revenue could go to reducing the Commonwealth substantial deficit. The Commonwealth has posted structural deficits for the last 8 years.\footcite[p.~4]{daleywood2015fiscalchallenges} On current policies these deficits are likely to continue. Projections for these deficits to reduce quickly over the 4 years of the forward estimates seem optimistic.  Budget repair will almost certainly require both tax increases and spending reductions.\footcite[p.~8-14]{daleywood2015fiscalchallenges} Tax increases through the GST are likely to distort economic activity less than most of the alternatives, and definitely less than the bracket creep which is the dominant driver of the Commonwealth's planned return to surplus.\footcite{daleywood2015fiscalchallenges}  Half of the available additional revenue from raising the GST to 15 per cent -- \$5 billion a year -- would only reduce the Commonwealth's budget deficit by around 15 per cent. 

\section{GST increases could fund other tax reductions}
The additional GST revenue could instead fund other tax reductions, including further income tax cuts,\footnote{Scott Morrison as quoted in \textcite{Coorey2015}}  cuts to corporate taxes,\footcite{FinancialServicesCouncil2015}  or State stamp duties.\footcite{PropertyCouncil2015}  The relative merits of these proposals are beyond the scope of this paper. Roughly speaking, additional revenue of \$5~billion from the GST could fund:
\begin{itemize}
\item a reduction in marginal income tax rates of nearly one percentage point for every bracket\footnote{Together this would cost around \$5.3~bn, \Vref{tbl:tax_cuts} on the budgetary costs of income tax rate changes. }
\end{itemize}

<<BottomQuintileFallingThroughCracks2, eval=TRUE>>=
library(party)
library(glmnet)

bottom.quintile.not.compensated <- 
  hes_with_gst_and_tax_compensation %>%
  age_mutate(.) %>%
  filter(gross_income_quintile == 1)

bottom.quintile.not.compensated <- 
  bottom.quintile.not.compensated %>%
  mutate(not_compensated = new_welfare + tax_diff_weekly < Weekly_household_GST_on_all_goods_and_services_FIS/2,
         has_welfare = Current_weekly_HH_income_from_government_pensions_and_allowances > 0,
         compensation_inadequacy = ifelse(not_compensated, 
                                          Weekly_household_GST_on_all_goods_and_services_FIS/2 - new_welfare - tax_diff_weekly,
                                          0),
         compensation_rel_adequate = -1 * (Weekly_household_GST_on_all_goods_and_services_FIS/2 - new_welfare - tax_diff_weekly)) %>%
  mutate(number_dependent_children = as.numeric(gsub("([0-9]) dependent.*$",
                                          "\\1",
                                          Number_of_dependent_children_aged_under_years_in_household)),
         number_dependent_children = ifelse(is.na(number_dependent_children),
                                            0,
                                            number_dependent_children),
         has_children = number_dependent_children > 0,
         is_self_funded_retiree = (!has_welfare) & age_group >= "60 to 64")

vars.to.exclude <- 
  c("new_welfare", 
    "Age_of_HH_reference_person",
    "tax_diff_weekly",
    "Unique_household_number",
    names(hes10hh)[grepl("(tax)|(expenditure)|(GST)", names(hes10hh))]
  )

indices.to.include <- which(!names(bottom.quintile.not.compensated) %in% vars.to.exclude)

bottom.quintile.not.compensated.all.vars <- bottom.quintile.not.compensated
bottom.quintile.not.compensated <- bottom.quintile.not.compensated[,indices.to.include,with=FALSE]

bottom.quintile.not.compensated %<>%
  mutate(
    Year_purchased_dwelling_HH_ranged_numeric = gsub("^([0-9]{4}).*$", "\\1", Year_purchased_dwelling_HH_ranged),
    Year_purchased_dwelling_HH_ranged_numeric = ifelse(grepl("before 1960", Year_purchased_dwelling_HH_ranged_numeric), "1955",
                                                       ifelse(grepl("2008", Year_purchased_dwelling_HH_ranged_numeric), "2008+",
                                                              Year_purchased_dwelling_HH_ranged_numeric)),
    Year_purchased_dwelling_HH_ranged_factor.ordered = factor(Year_purchased_dwelling_HH_ranged_numeric, ordered = TRUE)
  ) %>% 
  select(-Year_purchased_dwelling_HH_ranged)

bottom.quintile.not.compensated_factors <-
  bottom.quintile.not.compensated[, lapply(.SD, function(x) if(is.character(x)) as.factor(x) else x)]

bottom.quintile.not.compensated_factors %<>%
  mutate(age_group_orderedF = factor(age_group, ordered = TRUE))
@

<<degreeOfUndecompensation>>=
temp.chessboard <- 
  data.table::CJ(
    Unique_household_number = hes_with_gst_and_tax_compensation$Unique_household_number,
    comp_threshold.wk = seq.int(from = -10L, to = 10L, by = 1L)
  ) %>%
  data.table::setkey(Unique_household_number)

hes_with_gst_and_tax_compensation %>%
  setkey(Unique_household_number) %>%
  data.table:::merge.data.table(temp.chessboard) %>%
  group_by.income_quintile() %>%
  group_by(gross_income_quintile, comp_threshold.wk) %>%
  summarise(
    pc.comp = weighted.mean(Weekly_household_GST_on_all_goods_and_services_FIS/2 - new_welfare - tax_diff_weekly > comp_threshold.wk, Weight_HH_HES)
  ) %>%
  ungroup %>%
  filter(gross_income_quintile == 1) %>%
  grplot(aes(x = comp_threshold.wk,
             y = pc.comp)) + 
  geom_bar(stat = "identity")
  
@

<<selfFundedRetirees>>=
bottom.quintile.not.compensated_factors %>%
  group_by(not_compensated, is_self_funded_retiree) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>%
  mutate(prop = n/sum(n)) %>%
  arrange(not_compensated, is_self_funded_retiree)
@

<<UnderCompensationbyAgeandWelfareStatus>>=
bottom.quintile.not.compensated_factors %>%
  group_by(not_compensated, has_welfare, age_group) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% filter(not_compensated) %>%
  mutate(prop = n/sum(n),
         gross_income_quintile = 1)  %>% 
  arrange(has_welfare, age_group) %T>% 
  chart_data %>%
  mutate(age_group = gsub("\\s", "\n", age_group)) %>%
  grplot(aes(x = age_group, y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + theme(legend.position = c(0.15, 0.7),
                                                               axis.title.x = element_blank()) + 
  scale_y_continuous(label=percent)
@
\begin{figure}
\Caption{}{Proportion of undercompensated households in lowest quintile}{fig:UnderCompensationbyAgeandWelfareStatus}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/UnderCompensationbyAgeandWelfareStatus-1}
\source{Analysis of HES 2009-10}
\end{figure}

<<UnderCompensationbyChildren>>=
bottom.quintile.not.compensated_factors %>%
  group_by(not_compensated, has_welfare, number_dependent_children) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% 
  filter(not_compensated) %>%
  mutate(prop = n/sum(n))  %>% 
  grplot(aes(x = factor(number_dependent_children), y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + theme(legend.position = c(0.15, 0.7),
                                                               axis.title.x = element_blank()) + 
  scale_y_continuous(label=percent)
@

<<UnderCompensationbyPrevYrIncome>>=
bottom.quintile.not.compensated_factors %>%
  mutate(Prev_yr_HH_disp_income_factors = cut(Prev_fin_year_HH_disposable_income,
                                              breaks = c(0:5)*10e3, include.lowest = TRUE,
                                              dig.lab = 6)) %>%
  group_by(not_compensated, has_welfare, Prev_yr_HH_disp_income_factors) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% 
  filter(not_compensated) %>%
  mutate(prop = n/sum(n))  %>% 
  grplot(aes(x = factor(Prev_yr_HH_disp_income_factors), y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + theme(legend.position = c(0.15, 0.7),
                                                               axis.title.x = element_blank()) + 
  scale_y_continuous(label=percent)
@

<<UnderCompensationbyNetWealthAbbrev>>=
bottom.quintile.not.compensated_factors %>%
  mutate(Net_wealth_of_household_factors = cut(Net_wealth_of_household,
                                              breaks = cpi_inflator(c(-Inf, 0, 100e3, 200e3, 300e3, 400e3, 500e3, Inf), 
                                                                    to_fy = "2009-10",
                                                                    from_fy = "2014-15") * cpi_inflator(from_fy = "2013-14",
                                                                                                        to_fy = "2014-15"),
                                              labels = c("< $0", "\n$0-$100", 
                                                         "$100-$200", "\n$200-$300", 
                                                         "$300-$400", "\n$400-$500", 
                                                         "$500+"),
                                              include.lowest = TRUE,
                                              dig.lab = 6)) %>%
  group_by(not_compensated, has_welfare, Net_wealth_of_household_factors) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% 
  filter(not_compensated) %>%
  mutate(prop = n/sum(n),
         gross_income_quintile = 1) %T>% 
  chart_data %>%
  grplot(aes(x = factor(Net_wealth_of_household_factors), y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + 
  theme(legend.position = c(0.15, 0.7)) + 
  xlab("Net wealth of household (2014-15 dollars / 1000)") +
  scale_y_continuous(label=percent)
@
\begin{figure}
\caption{Percentage of undercompensated households in lowest quintile}\label{fig:UnderCompensationbyNetWealthAbbrev}
\includegraphics[width=\columnwidth]{figure_BudgetRepair_GST/UnderCompensationbyNetWealthAbbrev-1}
\source{Analysis of HES 2009-10}
\end{figure}

<<UnderCompensationbyConsumption>>=
hes_with_gst_and_tax_compensation %>%
  mutate(not_compensated = Weekly_household_GST_on_all_goods_and_services_FIS/2 > new_welfare + tax_diff_weekly) %>%
  mutate(Weekly_GST = cut(Weekly_household_GST_on_all_goods_and_services_FIS,
                          breaks = c(-Inf, 0, 10, 20, 30, 40, 50, 100, 200, Inf), 
                          include.lowest = TRUE)) %>%
  group_by(not_compensated, has_welfare, Weekly_GST) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% 
  filter(not_compensated) %>%
  mutate(prop = n/sum(n))  %>% 
  grplot(aes(x = factor(Weekly_GST), y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + theme(legend.position = c(0.15, 0.7),
                                                               axis.title.x = element_blank()) + 
  scale_y_continuous(label=percent)
@

<<UnderCompensationbyMainIncome>>=
bottom.quintile.not.compensated_factors %>%
  group_by(not_compensated, has_welfare, Main_source_of_current_HH_income) %>%
  summarise(n = sum(Weight_HH_HES)) %>%
  ungroup %>% 
  filter(not_compensated) %>%
  mutate(prop = n/sum(n))  %>% 
  grplot(aes(x = factor(Main_source_of_current_HH_income), y = prop)) + 
  geom_bar(stat = "identity", aes(fill = has_welfare)) + 
  theme(legend.position = c(0.15, 0.7),
        axis.title.x = element_blank()) + 
  scale_y_continuous(label=percent)
@

<<trees, eval=FALSE>>=
training. <- sample(1:nrow(bottom.quintile.not.compensated), size = 0.7 * nrow(bottom.quintile.not.compensated))
train.data <- bottom.quintile.not.compensated_factors[training., ]
test.data <- bottom.quintile.not.compensated_factors[!training., ]

buckets <- seq(from = 00e3, to = 500e3, by = 10e3)
party.errors <- numeric(length(buckets))

for (b in seq_along(buckets)){
  party.cracks.1 <- 
    party::ctree(factor(not_compensated) ~ Year_purchased_dwelling_HH_ranged_factor.ordered + Prev_fin_year_HH_disposable_income + number_dependent_children + has_children + age_group_orderedF + has_welfare +  Number_of_unemployed_persons_in_the_household + Net_wealth_of_household + is_self_funded_retiree, 
                 controls = ctree_control(minbucket = buckets[b]),
                 weights = round(train.data$Weight_HH_HES), 
                 data = train.data)
  pred.1 <- predict(party.cracks.1, newdata = test.data)
  cm <- confusionMatrix(pred.1, test.data$not_compensated)
  
  party.errors[b] = cm$overall['Accuracy']
}


party.cracks.2 <-
    party::ctree(factor(not_compensated) ~ Year_purchased_dwelling_HH_ranged_factor.ordered + Prev_fin_year_HH_disposable_income + number_dependent_children + has_children + age_group_orderedF + has_welfare +  Number_of_unemployed_persons_in_the_household + Net_wealth_of_household + is_self_funded_retiree, 
                 controls = ctree_control(minbucket = 100e3),
                 weights = round(train.data$Weight_HH_HES), 
                 data = train.data)
plot(party.cracks.2)

dev.copy2pdf(file = "PartyCracks.pdf", width = 32, height = 20)

training. <- sample(1:nrow(bottom.quintile.not.compensated), size = 0.7*nrow(bottom.quintile.not.compensated))
rpart.cracks <- rpart(factor(not_compensated) ~ ., data = bottom.quintile.not.compensated, 
                      weights = Weight_HH_HES,
                      control = rpart.control(minbucket = 250), subset = training.)

tree.cracks <- tree::tree(factor(not_compensated) ~ ., data = bottom.quintile.not.compensated, 
                          weights = Weight_HH_HES, subset = training.)

cv.cracks <- tree::cv.tree(tree.cracks)

rpart.cracks.certain.features <- 
  # aged under **15** years
  rpart(factor(not_compensated) ~ Year_purchased_dwelling_HH_ranged_factor.ordered + Prev_fin_year_HH_disposable_income + Number_of_dependent_children_aged_under_years_in_household + age_group + Number_of_unemployed_persons_in_the_household + Net_wealth_of_household + has_welfare, weights = Weight_HH_HES, data = bottom.quintile.not.compensated
        , control = rpart.control(minsplit = 50, minbucket = 100)
        )
plot(rpart.cracks)
text(rpart.cracks)
fancyRpartPlot(rpart.cracks)


@


<<BottomQuintileFallingThroughCracks3, eval=FALSE>>=
RF <- randomForest::randomForest(factor(not_compensated) ~ Year_purchased_dwelling_HH_ranged_factor.ordered + Prev_fin_year_HH_disposable_income + Number_of_dependent_children_aged_under_years_in_household + age_group + Number_of_unemployed_persons_in_the_household + Net_wealth_of_household, 
                                 data = bottom.quintile.not.compensated_factors,
                                 importance = TRUE)
@

<<BottomQuintileFallingThroughCracks4, eval=FALSE>>=
bottom.quintile.not.compensated_factors.noUniqueFactors <- 
  bottom.quintile.not.compensated_factors %>%
  select_(.dots = names(bottom.quintile.not.compensated_factors)[sapply(bottom.quintile.not.compensated_factors, function(x)length(unique(x))) > 1]) %>%
  select(-income.percentile)

x <- model.matrix(compensation_inadequacy ~ ., data = select(bottom.quintile.not.compensated_factors.noUniqueFactors, -not_compensated))
y <- bottom.quintile.not.compensated_factors$compensation_inadequacy

fit.lasso <- glmnet(x,y)
# http://stackoverflow.com/questions/30560689/adding-labels-on-curves-in-glmnet-plot-in-r
lbs_fun <- function(fit, ...) {
        L <- length(fit$lambda)
        x <- log(fit$lambda[L]) + 4
        y <- fit$beta[, L]
        labs <- names(y)
        text(x, y, labels=labs, cex = 0.5)
}
plot(fit.lasso, xvar = "lambda")
lbs_fun(fit.lasso)

@

<<Summary_of_cracks,eval=FALSE>>=
bottom.quintile.not.compensated_factors.noUniqueFactors %>%
  mutate(number_of_children = as.numeric(gsub("[^0-9]", "", Number_of_dependent_children_aged_under_years_in_household)),
         number_of_unemployed = as.numeric(gsub("[^0-9]", "", Number_of_unemployed_persons_in_the_household)),
         year_purchased_dwelling = as.numeric(as.character(Year_purchased_dwelling_HH_ranged_numeric)),
         number_of_unemployed = ifelse(is.na(number_of_unemployed), 0, number_of_unemployed),
         Age = as.numeric(gsub("^([0-9]{2}).*$", "\\1", as.character(age_group))) + 2.5) %>%
  gather(variable, value, 
         #Year_purchased_dwelling_HH_ranged_factor.ordered, 
         Prev_fin_year_HH_disposable_income, 
         number_of_children, 
         year_purchased_dwelling,
         Age, 
        # number_of_unemployed, 
         Net_wealth_of_household) %>%
#   group_by(not_compensated, variable) %>%
#   summarise(mean.value = mean(value)) %>%
  grplot(aes(x = variable, y = value, fill = not_compensated)) + 
  facet_wrap(~variable, scales = "free") + 
  geom_boxplot()
@

<<KNN, error=TRUE>>=
bottom.quintile.not.compensated_factors.noUniqueFactors %>% 
  mutate(
    age = as.numeric(gsub("^([0-9]{2}).*$", "\\1", age_group)) + runif(n(), min = 0, max = 5)
  ) %>%
  grplot(aes(x = Prev_fin_year_HH_disposable_income,
             y = age,
             color = factor(not_compensated),
             alpha = Weight_HH_HES)) + 
  geom_point() + 
  coord_cartesian(xlim = c(0, 100e3))
@




\clearpage
\onecolumn
<<sessionInfo, results='asis'>>=
addtorow          <- list()
addtorow$pos      <- list()
addtorow$pos[[1]] <- c(0)
addtorow$command  <- c(paste("\\hline \n",
                             "\\endhead \n",
                             "\\hline \n",
                             "{\\footnotesize Continued on next page} \n",
                             "\\endfoot \n",
                             "\\endlastfoot \n",sep=""))
# x.big <- xtable(x, label = "tabbig", caption = "Example of longtable spanning several pages")


devtools::session_info() %>%
  extract("packages") %>% 
  as.data.frame %>%
  xtable %>%
  print(., tabular.environment = "longtable", floating = FALSE,
      include.rownames = FALSE,  # because addtorow will substitute the default row names 
      add.to.row = addtorow,     # this is where you actually make the substitution
      hline.after=c(-1))  
@

<<package_cite>>=
# Select packages to cite:
citPkgs <- names(sessionInfo()$otherPkgs)
# Write the bibtex file:
knitr::write_bib(citPkgs, file="bibliography2.bib")      
package_cite_input <- paste0("\\nocite{", paste0(paste0("R-", citPkgs), collapse=","), "}")
write(package_cite_input, file = "package_cite_input_GST.tex")
@
\input{package_cite_input_GST}
\twocolumn
%\nocite{*}
{\raggedright
\theendnotes % footnotes as endnotes 
}
\printbibliography[title=References]
\end{document}